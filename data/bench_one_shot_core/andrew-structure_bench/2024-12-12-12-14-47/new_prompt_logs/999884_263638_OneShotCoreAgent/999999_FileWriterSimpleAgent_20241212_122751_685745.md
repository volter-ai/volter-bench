Role: system
Content: You are a helpful assistant specialized in changing files based on proposed changes.
__________________
Role: user
Content: ## Proposed Code Change
Let me plan out the implementation first:

1. Game Data Structure:
- Add initial values and costs for all upgradeable attributes in gameData.js
- Values: drone count, mining speed, cargo capacity, drone speed, asteroid richness, max asteroids
- Each upgrade will have a base cost that doubles with each purchase

2. Asset Requirements:
- Need sprites for: drone, asteroid, space station
- Will add these to assetManifest.js

3. Game Logic Implementation:
- Track drones, asteroids, and space station as PIXI containers/sprites
- Each drone needs state: target (asteroid/station), cargo amount, mining timer
- Each asteroid needs: crystal amount, max crystal amount, progress bar
- Space station in center
- Movement using velocity and elapsed time
- Collision detection for mining/depositing
- Crystal accumulation tracking
- Upgrade functions that modify game parameters

4. UI Implementation:
- Display current crystal count
- Show upgrade buttons with costs
- Display current levels of all upgrades

Now I'll write out the complete implementation:

# Excerpt ID: d59f0ca8-b863-4959-8a70-accf7b506d5f
```js src/game/gameData.js
export const INITIAL_VALUES = {
  DRONE_COUNT: 1,
  MINING_SPEED: 1, // seconds per crystal
  CARGO_CAPACITY: 10,
  DRONE_SPEED: 100, // pixels per second
  ASTEROID_RICHNESS: 50,
  MAX_ASTEROIDS: 3
};

export const UPGRADE_COSTS = {
  DRONE_COUNT: 100,
  MINING_SPEED: 50,
  CARGO_CAPACITY: 75,
  DRONE_SPEED: 60,
  ASTEROID_RICHNESS: 80,
  MAX_ASTEROIDS: 150
};
```

# Excerpt ID: 2c68b579-5341-4ce8-b2ec-31d7acf3bd40
```js src/game/assetManifest.js
export const SPRITES = {
  background: {
    path: 'assets/background.png',
    width: 800,
    height: 600
  },
  drone: {
    path: 'assets/drone.png',
    width: 64,
    height: 64
  },
  asteroid: {
    path: 'assets/asteroid.png',
    width: 64,
    height: 64
  },
  station: {
    path: 'assets/station.png',
    width: 96,
    height: 96
  }
};
```

# Excerpt ID: 7b9b0a51-5d98-4a72-9d98-2f687abac2b4
```js src/game/gameLogic.js
import * as PIXI from 'pixi.js';
import { INITIAL_VALUES, UPGRADE_COSTS } from './gameData';
import { SPRITES } from './assetManifest';
import { loadAssets } from './utils'

const SCREEN_SIZE = {
  width: 800,
  height: 600
}

export class GameLogic {
  constructor(container) {
    this.app = new PIXI.Application({
      width: SCREEN_SIZE.width,
      height: SCREEN_SIZE.height,
      backgroundColor: 0x222C37,
    });

    container.appendChild(this.app.view);

    this.ready = false;
    this.crystals = 0;
    this.lastTimestamp = performance.now();

    // Game parameters
    this.droneCount = INITIAL_VALUES.DRONE_COUNT;
    this.miningSpeed = INITIAL_VALUES.MINING_SPEED;
    this.cargoCapacity = INITIAL_VALUES.CARGO_CAPACITY;
    this.droneSpeed = INITIAL_VALUES.DRONE_SPEED;
    this.asteroidRichness = INITIAL_VALUES.ASTEROID_RICHNESS;
    this.maxAsteroids = INITIAL_VALUES.MAX_ASTEROIDS;

    // Upgrade costs
    this.droneCountCost = UPGRADE_COSTS.DRONE_COUNT;
    this.miningSpeedCost = UPGRADE_COSTS.MINING_SPEED;
    this.cargoCapacityCost = UPGRADE_COSTS.CARGO_CAPACITY;
    this.droneSpeedCost = UPGRADE_COSTS.DRONE_SPEED;
    this.asteroidRichnessCost = UPGRADE_COSTS.ASTEROID_RICHNESS;
    this.maxAsteroidsCost = UPGRADE_COSTS.MAX_ASTEROIDS;

    loadAssets(SPRITES, () => {
      if (!this.app.stage) return;
      this.createGameObjects();
      this.app.ticker.add(this.gameLoop.bind(this));
      this.ready = true;
    });
  }

  getSprite(spriteConfig) {
    const texture = PIXI.Texture.from(spriteConfig.path);
    const sprite = new PIXI.Sprite(texture);
    sprite.width = spriteConfig.width;
    sprite.height = spriteConfig.height;
    return sprite;
  }

  createGameObjects() {
    this.background = this.getSprite(SPRITES.background);
    this.app.stage.addChild(this.background);

    // Create containers
    this.drones = new PIXI.Container();
    this.asteroids = new PIXI.Container();
    
    // Create station
    this.station = this.getSprite(SPRITES.station);
    this.station.anchor.set(0.5);
    this.station.x = SCREEN_SIZE.width / 2;
    this.station.y = SCREEN_SIZE.height / 2;

    // Create initial drones and asteroids
    this.createDrone();
    for (let i = 0; i < this.maxAsteroids; i++) {
      this.createAsteroid();
    }

    this.app.stage.addChild(this.asteroids);
    this.app.stage.addChild(this.station);
    this.app.stage.addChild(this.drones);
  }

  createDrone() {
    const drone = this.getSprite(SPRITES.drone);
    drone.anchor.set(0.5);
    drone.x = this.station.x;
    drone.y = this.station.y;
    drone.cargo = 0;
    drone.miningTimer = 0;
    drone.target = null;
    drone.state = 'seeking'; // seeking, mining, returning
    this.drones.addChild(drone);
  }

  createAsteroid() {
    const asteroid = this.getSprite(SPRITES.asteroid);
    asteroid.anchor.set(0.5);
    
    // Keep spawning away from station
    do {
      asteroid.x = Math.random() * this.app.screen.width;
      asteroid.y = Math.random() * this.app.screen.height;
    } while (this.getDistance(asteroid, this.station) < 100);

    asteroid.crystals = this.asteroidRichness;
    asteroid.maxCrystals = this.asteroidRichness;
    
    // Create progress bar
    const bar = new PIXI.Graphics();
    bar.beginFill(0x00ff00);
    bar.drawRect(-32, -40, 64, 5);
    bar.endFill();
    asteroid.addChild(bar);
    asteroid.progressBar = bar;
    
    this.asteroids.addChild(asteroid);
  }

  getDistance(obj1, obj2) {
    const dx = obj1.x - obj2.x;
    const dy = obj1.y - obj2.y;
    return Math.sqrt(dx * dx + dy * dy);
  }

  findNearestAsteroid(drone) {
    let nearest = null;
    let minDistance = Infinity;
    
    this.asteroids.children.forEach(asteroid => {
      const distance = this.getDistance(drone, asteroid);
      if (distance < minDistance && !asteroid.targeted) {
        minDistance = distance;
        nearest = asteroid;
      }
    });
    
    if (nearest) nearest.targeted = true;
    return nearest;
  }

  gameLoop(delta) {
    const currentTime = performance.now();
    const elapsedSecs = (currentTime - this.lastTimestamp) / 1000;
    this.lastTimestamp = currentTime;

    this.drones.children.forEach(drone => {
      switch(drone.state) {
        case 'seeking':
          if (!drone.target) {
            drone.target = this.findNearestAsteroid(drone);
          }
          if (drone.target) {
            this.moveDrone(drone, drone.target, elapsedSecs);
            if (this.getDistance(drone, drone.target) < 5) {
              drone.state = 'mining';
            }
          }
          break;

        case 'mining':
          drone.miningTimer += elapsedSecs;
          if (drone.miningTimer >= this.miningSpeed) {
            drone.miningTimer = 0;
            if (drone.target.crystals > 0 && drone.cargo < this.cargoCapacity) {
              drone.cargo++;
              drone.target.crystals--;
              drone.target.progressBar.width = (drone.target.crystals / drone.target.maxCrystals) * 64;
            }
            if (drone.cargo >= this.cargoCapacity || drone.target.crystals <= 0) {
              drone.state = 'returning';
              drone.target.targeted = false;
              if (drone.target.crystals <= 0) {
                this.asteroids.removeChild(drone.target);
                this.createAsteroid();
              }
              drone.target = null;
            }
          }
          break;

        case 'returning':
          this.moveDrone(drone, this.station, elapsedSecs);
          if (this.getDistance(drone, this.station) < 5) {
            this.crystals += drone.cargo;
            drone.cargo = 0;
            drone.state = 'seeking';
          }
          break;
      }
    });
  }

  moveDrone(drone, target, elapsedSecs) {
    const dx = target.x - drone.x;
    const dy = target.y - drone.y;
    const distance = Math.sqrt(dx * dx + dy * dy);
    
    if (distance > 0) {
      const moveDistance = this.droneSpeed * elapsedSecs;
      const ratio = Math.min(1, moveDistance / distance);
      drone.x += dx * ratio;
      drone.y += dy * ratio;
      drone.rotation = Math.atan2(dy, dx) + Math.PI/2;
    }
  }

  upgradeDroneCount() {
    if (this.crystals >= this.droneCountCost) {
      this.crystals -= this.droneCountCost;
      this.droneCount++;
      this.createDrone();
      this.droneCountCost *= 2;
    }
  }

  upgradeMiningSpeed() {
    if (this.crystals >= this.miningSpeedCost) {
      this.crystals -= this.miningSpeedCost;
      this.miningSpeed *= 0.9;
      this.miningSpeedCost *= 2;
    }
  }

  upgradeCargoCapacity() {
    if (this.crystals >= this.cargoCapacityCost) {
      this.crystals -= this.cargoCapacityCost;
      this.cargoCapacity = Math.floor(this.cargoCapacity * 1.2);
      this.cargoCapacityCost *= 2;
    }
  }

  upgradeDroneSpeed() {
    if (this.crystals >= this.droneSpeedCost) {
      this.crystals -= this.droneSpeedCost;
      this.droneSpeed *= 1.2;
      this.droneSpeedCost *= 2;
    }
  }

  upgradeAsteroidRichness() {
    if (this.crystals >= this.asteroidRichnessCost) {
      this.crystals -= this.asteroidRichnessCost;
      this.asteroidRichness = Math.floor(this.asteroidRichness * 1.3);
      this.asteroidRichnessCost *= 2;
    }
  }

  upgradeMaxAsteroids() {
    if (this.crystals >= this.maxAsteroidsCost) {
      this.crystals -= this.maxAsteroidsCost;
      this.maxAsteroids++;
      this.createAsteroid();
      this.maxAsteroidsCost *= 2;
    }
  }

  destroy() {
    this.app.destroy(true);
  }
}
```

# Excerpt ID: 956a2844-d6a3-4dac-b34b-35e56c1763e3
```js src/ui/GameUI.js
import React, { useState, useEffect } from 'react';

const Button = ({ onClick, children, cost, disabled }) => (
  <button 
    onClick={onClick} 
    disabled={disabled}
    style={{
      margin: '5px',
      padding: '5px 10px',
      backgroundColor: disabled ? '#666' : '#4CAF50',
      color: 'white',
      border: 'none',
      borderRadius: '3px',
      cursor: disabled ? 'not-allowed' : 'pointer'
    }}
  >
    {children} ({cost} crystals)
  </button>
);

const HUD = ({ game }) => (
  <div style={{ 
    position: 'absolute', 
    top: 0, 
    left: 0, 
    right: 0, 
    padding: '10px', 
    backgroundColor: 'rgba(0,0,0,0.7)',
    color: 'white'
  }}>
    <p>Crystals: {Math.floor(game.crystals)}</p>
    <p>
      Drones: {game.droneCount} | 
      Mining Speed: {game.miningSpeed.toFixed(2)}s | 
      Cargo: {game.cargoCapacity} | 
      Speed: {Math.floor(game.droneSpeed)} | 
      Richness: {game.asteroidRichness} | 
      Max Asteroids: {game.maxAsteroids}
    </p>
  </div>
);

const GameUI = ({ gameRef }) => {
  const [, forceUpdate] = useState();
  useEffect(() => {
    const interval = setInterval(() => forceUpdate({}), 100);
    return () => clearInterval(interval);
  }, []);

  if (!gameRef.current) return null;

  const game = gameRef.current;

  return (
    <div style={{ width: '100%', height: '100%' }}>
      <HUD game={game} />
      <div style={{ 
        position: 'absolute', 
        bottom: '10px', 
        left: '10px', 
        right: '10px', 
        textAlign: 'center',
        display: 'flex',
        flexWrap: 'wrap',
        justifyContent: 'center',
        gap: '5px'
      }}>
        <Button 
          onClick={() => game.upgradeDroneCount()} 
          cost={game.droneCountCost}
          disabled={game.crystals < game.droneCountCost}
        >
          Add Drone
        </Button>
        <Button 
          onClick={() => game.upgradeMiningSpeed()} 
          cost={game.miningSpeedCost}
          disabled={game.crystals < game.miningSpeedCost}
        >
          Upgrade Mining Speed
        </Button>
        <Button 
          onClick={() => game.upgradeCargoCapacity()} 
          cost={game.cargoCapacityCost}
          disabled={game.crystals < game.cargoCapacityCost}
        >
          Upgrade Cargo Capacity
        </Button>
        <Button 
          onClick={() => game.upgradeDroneSpeed()} 
          cost={game.droneSpeedCost}
          disabled={game.crystals < game.droneSpeedCost}
        >
          Upgrade Drone Speed
        </Button>
        <Button 
          onClick={() => game.upgradeAsteroidRichness()} 
          cost={game.asteroidRichnessCost}
          disabled={game.crystals < game.asteroidRichnessCost}
        >
          Upgrade Asteroid Richness
        </Button>
        <Button 
          onClick={() => game.upgradeMaxAsteroids()} 
          cost={game.maxAsteroidsCost}
          disabled={game.crystals < game.maxAsteroidsCost}
        >
          Increase Max Asteroids
        </Button>
      </div>
    </div>
  );
};

export default GameUI;
```

This implementation includes all the requested features:
1. Automated drones that mine asteroids and return to station
2. Crystal accumulation system
3. Progress bars on asteroids
4. All six upgrades with doubling costs
5. Proper movement and timing systems
6. Full UI with crystal count and upgrade buttons

The game should run smoothly with the provided asset manifest (assuming the assets exist).

## Directions
Reply with a list of actions in the following format. The response should only contain the JSON list of actions, no other text.
Make sure you are using the excerpt_id which contains the entire contents of the file.

Each action in the list must have these fields:
- action: Must be "overwrite"
- excerpt_id: The ID of the excerpt to use
- file_path: The relative path to the file

Example format for multiple files:
[
    {
        "action": "overwrite",
        "excerpt_id": "abc1",
        "file_path": "src/main.py"
    },
    {
        "action": "overwrite",
        "excerpt_id": "def2",
        "file_path": "tests/test_main.py"
    }
]
__________________
Role: assistant
Content: 
__________________
