Role: system
Content: You are an expert software developer.

Here is the existing code of this game
```jsx src/pages/Story.jsx
import React, { useEffect, useState } from 'react';
import { CHARACTERS, LOCATIONS } from '../logic/gameData';

export default function Story({ gameLogic, onLeaveStory }) {
  const [content, setContent] = useState(null);
  const [location, setLocation] = useState(null);

  useEffect(() => {
    const current = gameLogic.getCurrentContent();
    setContent(current.content);
    setLocation(current.location);
  }, []);

  const handleAdvance = () => {
    const result = gameLogic.advance();
    if (result.isGameOver) {
      onLeaveStory();
      return;
    }

    const current = gameLogic.getCurrentContent();
    setContent(current.content);
    setLocation(current.location);
  };

  const handleChoice = (index) => {
    const result = gameLogic.makeChoice(index);
    if (result.isGameOver) {
      onLeaveStory();
      return;
    }

    const current = gameLogic.getCurrentContent();
    setContent(current.content);
    setLocation(current.location);
  };

  if (!content) return null;

  return (
    <div className="relative h-screen w-screen overflow-hidden bg-gray-900">
      {/* Background */}
      <div className="absolute inset-0 z-0">
        <div className="absolute inset-0 bg-black/50 z-10" />
        <img
          src={gameLogic.getSpriteUrl(LOCATIONS[location].spriteId)}
          alt="background"
          className="w-full h-full object-cover"
        />
      </div>

      {/* Character */}
      {content.type === 'dialog' && !content.noSpeakerSprite && (
        <div className="absolute bottom-0 left-1/2 -translate-x-1/2 z-20 min-w-0 min-h-0">
          <img
            src={gameLogic.getSpriteUrl(CHARACTERS[content.speaker].spriteId, content.variation)}
            alt={CHARACTERS[content.speaker].name}
            className="max-w-none"
            style={{ width: 'auto', height: 'auto' }}
          />
        </div>
      )}

      {/* Dialog/Choice UI */}
      <div className="absolute bottom-0 left-0 right-0 p-6 z-30">
        <div className="bg-gray-900/95 p-6 rounded-lg border border-gray-700">
          {content.type === 'dialog' && (
            <>
              <div className="text-2xl mb-3 font-bold text-white">
                {CHARACTERS[content.speaker].name}
              </div>
              <div className="text-lg mb-4 text-gray-200">
                {content.text}
              </div>
              <button
                onClick={handleAdvance}
                className="text-gray-400 text-sm hover:text-white transition-colors">
                Continue...
              </button>
            </>
          )}

          {content.type === 'narration' && (
            <>
              <div className="text-lg italic mb-4 text-gray-200">
                {content.text}
              </div>
              <button
                onClick={handleAdvance}
                className="text-gray-400 text-sm hover:text-white transition-colors">
                Continue...
              </button>
            </>
          )}

          {content.type === 'choice' && (
            <>
              <div className="text-lg mb-6 text-gray-200">
                {content.text}
              </div>
              <div className="space-y-3">
                {content.options.map((option, index) => (
                  <button
                    key={index}
                    onClick={() => handleChoice(index)}
                    className="w-full p-3 bg-gray-800 hover:bg-gray-700 rounded-lg text-left transition-colors border border-gray-700 text-white">
                    {option.text}
                  </button>
                ))}
              </div>
            </>
          )}
        </div>
      </div>
    </div>
  );
}

```
```js src/logic/gameLogic.js
import { CHARACTERS, LOCATIONS } from './gameData';
import { v4 } from 'uuid';
import { STORY_CONTENT } from './storyContent';
import { getSpriteUrl } from './assetUtils'

const deepClone = (obj) => JSON.parse(JSON.stringify(obj));

export default class GameLogic {
  constructor() {
    this.position = this.getInitialPosition();
  }

  getInitialPosition() {
    const firstChapter = Object.keys(STORY_CONTENT.chapters)[0];
    const firstScene = Object.keys(STORY_CONTENT.chapters[firstChapter].scenes)[0];
    const firstBeat = Object.keys(STORY_CONTENT.chapters[firstChapter].scenes[firstScene].beats)[0];

    return {
      chapter: firstChapter,
      scene: firstScene,
      beat: firstBeat,
      lineIndex: 0
    };
  }

  getSpriteUrl(spriteId, variation = null) {
    return getSpriteUrl(spriteId, variation);
  }

  reset() {
    this.position = this.getInitialPosition();
    return this.position;
  }

  getCurrentContent() {
    const { chapter, scene, beat, lineIndex } = this.position;

    if (!STORY_CONTENT.chapters[chapter]) {
      throw new Error(`Chapter ${chapter} not found`);
    }

    const currentScene = STORY_CONTENT.chapters[chapter].scenes[scene];
    if (!currentScene) {
      throw new Error(`Scene ${scene} not found in chapter ${chapter}`);
    }

    const currentBeat = currentScene.beats[beat];
    if (!currentBeat) {
      throw new Error(`Beat ${beat} not found in scene ${scene}`);
    }

    if (lineIndex >= currentBeat.lines.length) {
      throw new Error(`Line index ${lineIndex} out of bounds`);
    }

    return {
      content: currentBeat.lines[lineIndex],
      location: currentScene.location
    };
  }

  handleTransition(next) {
    if (!next) {
      throw new Error('Cannot advance: no next position specified');
    }

    if (next.isGameOver) {
      return { isGameOver: true };
    }

    if (!next.chapter || !next.scene || !next.beat) {
      throw new Error('Next position must specify chapter, scene and beat');
    }

    this.position = {
      chapter: next.chapter,
      scene: next.scene,
      beat: next.beat,
      lineIndex: 0
    };

    return this.position;
  }

  advance() {
    const { chapter, scene, beat, lineIndex } = this.position;
    const currentScene = STORY_CONTENT.chapters[chapter].scenes[scene];
    const currentBeat = currentScene.beats[beat];

    if (lineIndex + 1 < currentBeat.lines.length) {
      this.position.lineIndex += 1;
      return this.position;
    }

    return this.handleTransition(currentBeat.next);
  }

  makeChoice(choiceIndex) {
    const { content } = this.getCurrentContent();
    if (content.type !== 'choice') {
      throw new Error('Current content is not a choice');
    }

    const choice = content.options[choiceIndex];
    if (!choice) {
      throw new Error(`Invalid choice index: ${choiceIndex}`);
    }

    return this.handleTransition(choice.next);
  }
}

```
```js src/logic/gameLogic.test.js
import GameLogic from './gameLogic';
import { STORY_CONTENT } from './storyContent';
import { CHARACTERS, LOCATIONS } from './gameData';
import { initialize } from './assetUtils';

describe('GameLogic', () => {
  let game;

  beforeAll(() => {
    game = new GameLogic();
    return initialize();
  });

  describe('validate story content', () => {
    test('validate all story content', () => {
      const errors = [];
      const game = new GameLogic();

      // Validate all story content
      Object.entries(STORY_CONTENT.chapters).forEach(([chapterId, chapter]) => {
        // Skip validation for placeholder content
        if (chapter.isPlaceholder) return;

        Object.entries(chapter.scenes).forEach(([sceneId, scene]) => {
          // Validate location
          try {
            game.getSpriteUrl(scene.location);
          } catch (error) {
            errors.push(`Invalid location ${scene.location} in chapter ${chapterId}, scene ${sceneId}`);
          }

          Object.entries(scene.beats).forEach(([beatId, beat]) => {
            beat.lines.forEach((line, lineIndex) => {
              // Validate character sprites
              if (line.type === 'dialog') {
                if (!CHARACTERS[line.speaker]) {
                  errors.push(`Invalid character ${line.speaker} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                }
                if (!line.noSpeakerSprite) {
                  try {
                    game.getSpriteUrl(line.speaker, line.variation);
                  } catch (error) {
                    errors.push(`${error.message} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                  }
                }
              }

              // Validate choices
              if (line.type === 'choice') {
                line.options.forEach((option, optionIndex) => {
                  if (!option.next && !option.next.isGameOver) {
                    errors.push(`Missing next for choice option ${optionIndex} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                  }
                });
              }
            });

            // Validate next references
            if (beat.next && !beat.next.isGameOver) {
              const { chapter, scene, beat: nextBeat } = beat.next;
              if (!STORY_CONTENT.chapters[chapter]?.scenes[scene]?.beats[nextBeat]) {
                errors.push(`Invalid next reference "${chapter}.${scene}.${nextBeat}" in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}`);
              }
            }
          });
        });
      });

      if (errors.length > 0) {
        throw new Error('Story validation failed:\n' + errors.join('\n'));
      }
    });
  });

  describe('full simulation', () => {
    test('simulate the game many times until the end', () => {
      // Skip simulation if all content is placeholder
      if (Object.values(STORY_CONTENT.chapters).every(chapter => chapter.isPlaceholder)) {
        return;
      }

      const endingsSeen = new Set();
      
      // Run 100 simulations
      for (let i = 0; i < 100; i++) {
        game.reset();
        let isGameOver = false;

        // Run 1000 steps in the story
        for (let j = 0; j < 1000; j++) {
          const { content, location } = game.getCurrentContent();
          
          // Validate location sprite
          game.getSpriteUrl(location);
          
          // Validate character sprites if dialog
          if (content.type === 'dialog' && !content.noSpeakerSprite) {
            game.getSpriteUrl(content.speaker, content.variation);
          }

          if (content.type === 'choice') {
            // Make random choice
            const choiceIndex = Math.floor(Math.random() * content.options.length);
            const result = game.makeChoice(choiceIndex);
            isGameOver = result.isGameOver;
          } else {
            const result = game.advance();
            isGameOver = result.isGameOver;
          }

          if (isGameOver) {
            break;
          }
        }

        if (!isGameOver) {
          throw new Error('1000 steps in the simulation were run but we did not reach game over');
        }

        // Record which ending was reached
        const { beat } = game.position;
        endingsSeen.add(beat);
      }
    });
  });
});

```
```js src/logic/gameData.js
// all game entities (other than the player) such as characters, etc. can be declared here
/*
export const ENTITY = {
  entityName: {
      prototypeId: 'entityName',
      name: 'Entity Name',
      spriteId: "entity"
    }
}
*/

```
```js src/logic/assetManifest.js
export const SPRITES = {
  /*
  "exampleCharacter": {
    srcs: "assets/characters/exampleCharacter-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "exampleLocation": {
    srcs: "assets/locations/exampleLocation.png",
    width: 1216,
    height: 960
  },
  "exampleBackground": {
    srcs: "assets/background/exampleBackground.png",
    width: 1216,
    height: 960
  },
   */
};
```
```js src/logic/storyContent.js
import chapter1 from './content/chapter1';

export const STORY_CONTENT = {
  chapters: {
    chapter1
  }
}

```

```js src/logic/content/chapter1.js
export default {
  scenes: {
    intro: {
      location: 'locationId',
      beats: {
        beatNameHere: {
          lines: [
            /*
            {
              type: 'narration',
              text: 'some narration goes here'
            },
            {
              type: 'dialog',
              speaker: 'characterId',
              variation: 'neutral',
              text: 'some dialog goes here'
            }
             */
          ]
        }
      }
    }
  }
}

```

__________________
Role: user
Content: Now make the changes to the code files based on this story

```markdown docs/chapters/chapter1.md
# Chapter 1: Shadows Awakening

## Scene 1: Whispers in the Void

*Darkness envelops everything. A faint dripping sound echoes in the distance. Alex awakens on a cold, hard floor.*

**Alex:** "Ugh... my head. Where am I?"

*A soft whisper brushes past their ear.*

**Whisper:** "Awaken..."

**Alex:** "Who's there? Show yourself!"

*Silence. Alex strains their eyes but sees nothing.*

**Alex:** "Great. Just great. Lost in the dark with voices. Think, Alex, think."

## Beat: Echoes of Silence

*Alex feels around, their hands sliding over damp walls.*

**Alex:** "Feels like stone. Maybe an old building?"

*A faint light flickers to the left; a distant sound echoes to the right.*

## Decision Point 1: The First Choice

*Option 1: Follow the faint light.*

*Option 2: Follow the distant sound.*

### Choice 1: Follow the Faint Light

**Alex:** "Light means a way out. Let's hope that's true."

*They move cautiously towards the flickering glow.*

### Choice 2: Follow the Distant Sound

**Alex:** "Maybe that sound is someone who can help."

*They head towards the sound, footsteps echoing.*

## Scene 2: Fork in the Path

### If Followed the Light:

*Alex enters a chamber illuminated by strange symbols.*

**Alex:** "What is this place?"

*A figure steps out of the shadows.*

**Mysterious Figure:** "You've finally arrived."

**Alex:** "Who are you?"

**Mysterious Figure:** "A friend. Perhaps more."

### If Followed the Sound:

*Alex finds themselves in a corridor with flickering lights. A radio crackles nearby.*

**Radio Voice:** "Is someone there?"

**Alex:** "Yes! I'm here! Who is this?"

**Radio Voice:** "Help is on the way. Trust no one."

**Alex:** "Wait, what do you mean?"

## Beat: Trust or Doubt

**Alex:** "This is getting weirder by the minute."

*Footsteps approach.*

**Stranger:** "You look lost."

**Alex:** "That's an understatement."

**Stranger:** "Come with me. I can help."

## Decision Point 2: Trust or Doubt

*Option 1: Trust the stranger and follow them.*

*Option 2: Doubt their intentions and stay back.*

### Choice 1: Trust the Stranger

**Alex:** "Alright. Lead the way."

**Stranger:** "Wise decision."

*They walk together down a dimly lit hallway.*

### Choice 2: Doubt Their Intentions

**Alex:** "I think I'll manage on my own."

**Stranger:** "Suit yourself. Don't say I didn't warn you."

*The stranger fades into the darkness.*

## Scene 3: Unveiling Shadows

*Alone, Alex continues exploring.*

**Alex:** "Maybe I should've gone with them."

*They stumble upon a wall covered in drawings.*

**Alex:** "These symbols... why do they feel familiar?"

*A sudden pain flashes in their head.*

**Voice in Head:** "Remember..."

**Alex:** "Ah! What was that?"

## Beat: Fight or Flight

*A shadowy figure emerges behind them.*

**Shadowy Figure:** "You shouldn't be here."

**Alex:** "Who are you?"

**Shadowy Figure:** "Your end."

## Decision Point 3: Fight or Flight

*Option 1: Stand and fight.*

*Option 2: Run away.*

### Choice 1: Stand and Fight

**Alex:** "I'm not afraid of you!"

*They clench their fists, ready to defend themselves.*

### Choice 2: Run Away

**Alex:** "Nope! Not dealing with this!"

*Alex turns and sprints down the corridor.*

## Ending Scene: The Awakening

*Regardless of the choice, the ground trembles. Time seems to slow.*

**Alex:** "What's happening?"

*Objects around them float as if suspended.*

**Mysterious Figure (reappearing):** "It's awakening within you."

**Alex:** "What is?"

**Mysterious Figure:** "Your true power."

## Beat: Embrace or Reject

**Alex:** "My... power?"

**Mysterious Figure:** "Yes. The ability to manipulate time itself."

**Alex:** "This can't be real."

## Decision Point 4: Embrace or Reject

*Option 1: Embrace the power.*

*Option 2: Reject the power.*

### Choice 1: Embrace the Power

**Alex:** "If this is real, I need to control it."

*They focus, and time begins to move normally.*

**Mysterious Figure:** "Good. You're beginning to understand."

### Choice 2: Reject the Power

**Alex:** "No! I won't be a part of this!"

*Time snaps back, and the world feels heavier.*

**Mysterious Figure:** "Denial won't change destiny."

---

**End of Chapter 1**

```

Implementation Order:
1. write or rewrite the chapter file in `src/logic/content`
2. if this is not the first chapter, edit another earlier chapter from `src/logic/content` so that it would lead to this chapter rather than going to gameOver 
3. add the chapter to `src/logic/storyContent.js` as needed 
4. add new locations, characters, etc. to `src/logic/gameData.js` as needed 
5. add new assets to `src/logic/assetManifest.js` as needed

No other files can be changed

Do not leave any lines unwritten, because I do not know how to fill out this code. You should fill out the code not me

Content Guidelines:
1. DO NOT alter a single word of the story as it is written in the document. You must reproduce it faithfully word for word
2. Every line of dialog must have a variation. The available variations are neutral, happy, sad, embarrassed, crying, surprised, angry, thinking. The majority of dialog should be showing neutral
3. If a line of dialog is spoken by an off-screen character, noSpeakerSprite should be set to true (do not set it to true unless the character is explicitly off-screen)

Asset Manifest Guidelines:
- The screen size is exactly 390x844 so make sure all the assets are an appropriate size
- The background should be 1216x960 because we will allow the user to pan the background. The viewport will still be 390x844
- All characters should be 416x624. It will be slightly wider than the viewport
- Each character can have the variations: neutral, happy, sad, embarrassed, crying, surprised, angry, thinking
- Replace all the default assets with the assets in this game's story

General Implementation Guidelines:
1. Write out all the code of the files you intend to edit. I will be copy-pasting them
2. Do not do any refactoring aside from what you are requested to do

Directions:
In your response, do both steps, one after the other
1. First think carefully and describe in detail how you will implement the project design. Make sure to follow all the guidelines
2. Then write each file, according to the plan. Write the files exactly in the Implementation Order

Write out all the files in the format:
```filetype filepath
content
```

MOST IMPORTANT: Do not write "existing code here" or similar placeholders. If a file has been edited in anyway,
EVERY original unchanged line must be rewritten in your output
__________________
Role: assistant
Content: Let me plan out the implementation:

1. Chapter File Implementation:
- Create a detailed chapter1.js with all scenes, beats, and choices
- Each scene will map to the story sections
- Ensure every dialog has a variation specified
- Add noSpeakerSprite for off-screen characters like the Whisper and Radio Voice
- Create proper next transitions between all beats and choices

2. Game Data:
Need to add these characters:
- Alex (protagonist)
- Mysterious Figure
- Stranger
- Shadowy Figure
- Whisper (off-screen only)
- Radio Voice (off-screen only)

Need to add these locations:
- darkChamber (for the initial void scene)
- symbolChamber (for the glowing symbols room)
- corridor (for the hallway scenes)

3. Asset Manifest:
Add sprites for:
Characters (all with 416x624 dimensions):
- alex
- mysteriousFigure  
- stranger
- shadowyFigure

Locations (all with 1216x960 dimensions):
- darkChamber
- symbolChamber
- corridor

Now I'll implement each file in order:

```js src/logic/content/chapter1.js
export default {
  scenes: {
    void: {
      location: 'darkChamber',
      beats: {
        awakening: {
          lines: [
            {
              type: 'narration',
              text: 'Darkness envelops everything. A faint dripping sound echoes in the distance. Alex awakens on a cold, hard floor.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'confused',
              text: 'Ugh... my head. Where am I?'
            },
            {
              type: 'narration',
              text: 'A soft whisper brushes past their ear.'
            },
            {
              type: 'dialog',
              speaker: 'whisper',
              variation: 'neutral',
              noSpeakerSprite: true,
              text: 'Awaken...'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: "Who's there? Show yourself!"
            },
            {
              type: 'narration',
              text: 'Silence. Alex strains their eyes but sees nothing.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: 'Great. Just great. Lost in the dark with voices. Think, Alex, think.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'void',
            beat: 'echoes'
          }
        },
        echoes: {
          lines: [
            {
              type: 'narration',
              text: 'Alex feels around, their hands sliding over damp walls.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: 'Feels like stone. Maybe an old building?'
            },
            {
              type: 'narration',
              text: 'A faint light flickers to the left; a distant sound echoes to the right.'
            },
            {
              type: 'choice',
              text: 'Which way should Alex go?',
              options: [
                {
                  text: 'Follow the faint light',
                  next: {
                    chapter: 'chapter1',
                    scene: 'void',
                    beat: 'followLight'
                  }
                },
                {
                  text: 'Follow the distant sound',
                  next: {
                    chapter: 'chapter1',
                    scene: 'void',
                    beat: 'followSound'
                  }
                }
              ]
            }
          ]
        },
        followLight: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: "Light means a way out. Let's hope that's true."
            },
            {
              type: 'narration',
              text: 'They move cautiously towards the flickering glow.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'fork',
            beat: 'lightPath'
          }
        },
        followSound: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: 'Maybe that sound is someone who can help.'
            },
            {
              type: 'narration',
              text: 'They head towards the sound, footsteps echoing.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'fork',
            beat: 'soundPath'
          }
        }
      }
    },
    fork: {
      location: 'symbolChamber',
      beats: {
        lightPath: {
          lines: [
            {
              type: 'narration',
              text: 'Alex enters a chamber illuminated by strange symbols.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'What is this place?'
            },
            {
              type: 'narration',
              text: 'A figure steps out of the shadows.'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: "You've finally arrived."
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Who are you?'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: 'A friend. Perhaps more.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'fork',
            beat: 'trustOrDoubt'
          }
        },
        soundPath: {
          lines: [
            {
              type: 'narration',
              text: 'Alex finds themselves in a corridor with flickering lights. A radio crackles nearby.'
            },
            {
              type: 'dialog',
              speaker: 'radioVoice',
              variation: 'neutral',
              noSpeakerSprite: true,
              text: 'Is someone there?'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: "Yes! I'm here! Who is this?"
            },
            {
              type: 'dialog',
              speaker: 'radioVoice',
              variation: 'neutral',
              noSpeakerSprite: true,
              text: 'Help is on the way. Trust no one.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'confused',
              text: 'Wait, what do you mean?'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'fork',
            beat: 'trustOrDoubt'
          }
        },
        trustOrDoubt: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: "This is getting weirder by the minute."
            },
            {
              type: 'narration',
              text: 'Footsteps approach.'
            },
            {
              type: 'dialog',
              speaker: 'stranger',
              variation: 'neutral',
              text: 'You look lost.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: "That's an understatement."
            },
            {
              type: 'dialog',
              speaker: 'stranger',
              variation: 'neutral',
              text: 'Come with me. I can help.'
            },
            {
              type: 'choice',
              text: 'What should Alex do?',
              options: [
                {
                  text: 'Trust the stranger and follow them',
                  next: {
                    chapter: 'chapter1',
                    scene: 'fork',
                    beat: 'trust'
                  }
                },
                {
                  text: 'Doubt their intentions and stay back',
                  next: {
                    chapter: 'chapter1',
                    scene: 'fork',
                    beat: 'doubt'
                  }
                }
              ]
            }
          ]
        },
        trust: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: 'Alright. Lead the way.'
            },
            {
              type: 'dialog',
              speaker: 'stranger',
              variation: 'neutral',
              text: 'Wise decision.'
            },
            {
              type: 'narration',
              text: 'They walk together down a dimly lit hallway.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'shadows',
            beat: 'exploration'
          }
        },
        doubt: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: "I think I'll manage on my own."
            },
            {
              type: 'dialog',
              speaker: 'stranger',
              variation: 'neutral',
              text: "Suit yourself. Don't say I didn't warn you."
            },
            {
              type: 'narration',
              text: 'The stranger fades into the darkness.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'shadows',
            beat: 'exploration'
          }
        }
      }
    },
    shadows: {
      location: 'corridor',
      beats: {
        exploration: {
          lines: [
            {
              type: 'narration',
              text: 'Alone, Alex continues exploring.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: "Maybe I should've gone with them."
            },
            {
              type: 'narration',
              text: 'They stumble upon a wall covered in drawings.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: 'These symbols... why do they feel familiar?'
            },
            {
              type: 'narration',
              text: 'A sudden pain flashes in their head.'
            },
            {
              type: 'dialog',
              speaker: 'whisper',
              variation: 'neutral',
              noSpeakerSprite: true,
              text: 'Remember...'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Ah! What was that?'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'shadows',
            beat: 'fightOrFlight'
          }
        },
        fightOrFlight: {
          lines: [
            {
              type: 'narration',
              text: 'A shadowy figure emerges behind them.'
            },
            {
              type: 'dialog',
              speaker: 'shadowyFigure',
              variation: 'neutral',
              text: "You shouldn't be here."
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Who are you?'
            },
            {
              type: 'dialog',
              speaker: 'shadowyFigure',
              variation: 'neutral',
              text: 'Your end.'
            },
            {
              type: 'choice',
              text: 'What should Alex do?',
              options: [
                {
                  text: 'Stand and fight',
                  next: {
                    chapter: 'chapter1',
                    scene: 'shadows',
                    beat: 'fight'
                  }
                },
                {
                  text: 'Run away',
                  next: {
                    chapter: 'chapter1',
                    scene: 'shadows',
                    beat: 'flee'
                  }
                }
              ]
            }
          ]
        },
        fight: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'angry',
              text: "I'm not afraid of you!"
            },
            {
              type: 'narration',
              text: 'They clench their fists, ready to defend themselves.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'awakening',
            beat: 'timeStop'
          }
        },
        flee: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Nope! Not dealing with this!'
            },
            {
              type: 'narration',
              text: 'Alex turns and sprints down the corridor.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'awakening',
            beat: 'timeStop'
          }
        }
      }
    },
    awakening: {
      location: 'symbolChamber',
      beats: {
        timeStop: {
          lines: [
            {
              type: 'narration',
              text: 'Regardless of the choice, the ground trembles. Time seems to slow.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: "What's happening?"
            },
            {
              type: 'narration',
              text: 'Objects around them float as if suspended.'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: "It's awakening within you."
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'What is?'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: 'Your true power.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'awakening',
            beat: 'finalChoice'
          }
        },
        finalChoice: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'confused',
              text: 'My... power?'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: 'Yes. The ability to manipulate time itself.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: "This can't be real."
            },
            {
              type: 'choice',
              text: 'What should Alex do?',
              options: [
                {
                  text: 'Embrace the power',
                  next: {
                    chapter: 'chapter1',
                    scene: 'awakening',
                    beat: 'embrace'
                  }
                },
                {
                  text: 'Reject the power',
                  next: {
                    chapter: 'chapter1',
                    scene: 'awakening',
                    beat: 'reject'
                  }
                }
              ]
            }
          ]
        },
        embrace: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: 'If this is real, I need to control it.'
            },
            {
              type: 'narration',
              text: 'They focus, and time begins to move normally.'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: "Good. You're beginning to understand."
            }
          ],
          next: {
            isGameOver: true
          }
        },
        reject: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'angry',
              text: "No! I won't be a part of this!"
            },
            {
              type: 'narration',
              text: 'Time snaps back, and the world feels heavier.'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: "Denial won't change destiny."
            }
          ],
          next: {
            isGameOver: true
          }
        }
      }
    }
  }
}
```

```js src/logic/gameData.js
export const CHARACTERS = {
  alex: {
    prototypeId: 'alex',
    name: 'Alex',
    spriteId: 'alex'
  },
  mysteriousFigure: {
    prototypeId: 'mysteriousFigure',
    name: 'Mysterious Figure',
    spriteId: 'mysteriousFigure'
  },
  stranger: {
    prototypeId: 'stranger',
    name: 'Stranger',
    spriteId: 'stranger'
  },
  shadowyFigure: {
    prototypeId: 'shadowyFigure',
    name: 'Shadowy Figure',
    spriteId: 'shadowyFigure'
  },
  whisper: {
    prototypeId: 'whisper',
    name: 'Whisper',
    spriteId: 'whisper'
  },
  radioVoice: {
    prototypeId: 'radioVoice',
    name: 'Radio Voice',
    spriteId: 'radioVoice'
  }
}

export const LOCATIONS = {
  darkChamber: {
    prototypeId: 'darkChamber',
    name: 'Dark Chamber',
    spriteId: 'darkChamber'
  },
  symbolChamber: {
    prototypeId: 'symbolChamber',
    name: 'Symbol Chamber',
    spriteId: 'symbolChamber'
  },
  corridor: {
    prototypeId: 'corridor',
    name: 'Corridor',
    spriteId: 'corridor'
  }
}
```

```js src/logic/assetManifest.js
export const SPRITES = {
  "alex": {
    srcs: "assets/characters/alex-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "mysteriousFigure": {
    srcs: "assets/characters/mysteriousFigure-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "stranger": {
    srcs: "assets/characters/stranger-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "shadowyFigure": {
    srcs: "assets/characters/shadowyFigure-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "darkChamber": {
    srcs: "assets/locations/darkChamber.png",
    width: 1216,
    height: 960
  },
  "symbolChamber": {
    srcs: "assets/locations/symbolChamber.png",
    width: 1216,
    height: 960
  },
  "corridor": {
    srcs: "assets/locations/corridor.png",
    width: 1216,
    height: 960
  }
}
```

```js src/logic/storyContent.js
import chapter1 from './content/chapter1';

export const STORY_CONTENT = {
  chapters: {
    chapter1
  }
}
```
__________________
Role: user
Content: there was an issue [issue redacted] with the implementation, fix it
__________________
Role: user
Content: We had the issue



bun tests failed with return code 1. Full output:

$ jest --verbose
FAIL src/logic/gameLogic.test.js
GameLogic
validate story content
✕ validate all story content
full simulation
✕ simulate the game many times until the end

● GameLogic › validate story content › validate all story content

Story validation failed:
Invalid variation confused for sprite alex. Valid variations are: neutral, happy, sad, embarrassed, crying, surprised, angry, thinking in chapter chapter1, scene void, beat awakening, line 1
Invalid variation confused for sprite alex. Valid variations are: neutral, happy, sad, embarrassed, crying, surprised, angry, thinking in chapter chapter1, scene fork, beat soundPath, line 4
Invalid variation confused for sprite alex. Valid variations are: neutral, happy, sad, embarrassed, crying, surprised, angry, thinking in chapter chapter1, scene awakening, beat finalChoice, line 0

68 |
69 |       if (errors.length > 0) {
> 70 |         throw new Error('Story validation failed:\n' + errors.join('\n'));
|               ^
71 |       }
72 |     });
73 |   });

at Object.<anonymous> (src/logic/gameLogic.test.js:70:15)

● GameLogic › full simulation › simulate the game many times until the end

Invalid variation confused for sprite alex. Valid variations are: neutral, happy, sad, embarrassed, crying, surprised, angry, thinking

74 |     // Validate the variation exists
75 |     if (!sprite.variations.includes(variation)) {
> 76 |       throw new Error(`Invalid variation ${variation} for sprite ${spriteId}. Valid variations are: ${sprite.variations.join(', ')}`);
|             ^
77 |     }
78 |
79 |     // Replace the {variation} placeholder in the URL

at getSpriteUrl (src/logic/assetUtils.js:76:13)
at GameLogic.getSpriteUrl (src/logic/gameLogic.js:27:24)
at Object.getSpriteUrl (src/logic/gameLogic.test.js:98:18)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 2 total
Snapshots:   0 total
Time:        [REDACTED]
Ran all test suites.
error: script "test:all" exited with code 1




Fixer guidelines:

1. Do NOT use defensive programming. Throw errors when we receive unexpectedly empty data so we can discover the root cause



Directions:

In your response, do both steps, one after the other

1. For each issue, first think carefully and describe in detail what went wrong and how you will fix it. First describe whether this is the first time you're seeing the issue, if not describe previous solutions you tried in detail. Then do a root cause analysis, is this a problem with the code or with the test. Now explain in detail why the previous solution did not work. Then create your new solution and explain why it's different. For each of those steps, make sure to trace through the part of the code and any console log information you might have that can help you diagnose the issue. Use as much detail as possible and include specific console logs and lines of code inside of your analysis. The analysis of each issue must be at least 30 lines long

2. Then write each file, according to the plan



Write out all the files in the format:

```filetype filepath

content

```



MOST IMPORTANT: Do not write "existing code here" or similar placeholders. If a file has been edited in anyway,

EVERY original unchanged line must be rewritten in your output
__________________
Role: assistant
Content: Issue Analysis:

The error shows that we're using an invalid variation "confused" for the alex sprite in multiple locations. This is the first time seeing this issue.

Root Cause Analysis:
1. In chapter1.js, we used "confused" as a variation in several dialog lines:
   - Line 1 in void/awakening beat: alex with "confused" variation
   - Line 4 in fork/soundPath beat: alex with "confused" variation
   - Line 0 in awakening/finalChoice beat: alex with "confused" variation

2. Looking at assetManifest.js, the only valid variations are:
```javascript
variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking']
```

3. The error is thrown in assetUtils.js when it checks if the variation exists:
```javascript
if (!sprite.variations.includes(variation)) {
  throw new Error(`Invalid variation ${variation} for sprite ${spriteId}...`);
}
```

4. This is a problem with the content code, not the test. The test is correctly catching invalid variations.

5. Looking at the story context, "confused" was used when Alex is:
   - Waking up disoriented
   - Questioning the radio voice
   - Questioning their power

Solution:
We should replace "confused" with appropriate valid variations:
- For waking up disoriented: use "thinking"
- For questioning the radio voice: use "surprised"
- For questioning power: use "surprised"

These alternatives maintain the emotional intent while using valid variations.

Here's the implementation fix:

```js src/logic/content/chapter1.js
export default {
  scenes: {
    void: {
      location: 'darkChamber',
      beats: {
        awakening: {
          lines: [
            {
              type: 'narration',
              text: 'Darkness envelops everything. A faint dripping sound echoes in the distance. Alex awakens on a cold, hard floor.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: 'Ugh... my head. Where am I?'
            },
            {
              type: 'narration',
              text: 'A soft whisper brushes past their ear.'
            },
            {
              type: 'dialog',
              speaker: 'whisper',
              variation: 'neutral',
              noSpeakerSprite: true,
              text: 'Awaken...'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: "Who's there? Show yourself!"
            },
            {
              type: 'narration',
              text: 'Silence. Alex strains their eyes but sees nothing.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: 'Great. Just great. Lost in the dark with voices. Think, Alex, think.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'void',
            beat: 'echoes'
          }
        },
        echoes: {
          lines: [
            {
              type: 'narration',
              text: 'Alex feels around, their hands sliding over damp walls.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: 'Feels like stone. Maybe an old building?'
            },
            {
              type: 'narration',
              text: 'A faint light flickers to the left; a distant sound echoes to the right.'
            },
            {
              type: 'choice',
              text: 'Which way should Alex go?',
              options: [
                {
                  text: 'Follow the faint light',
                  next: {
                    chapter: 'chapter1',
                    scene: 'void',
                    beat: 'followLight'
                  }
                },
                {
                  text: 'Follow the distant sound',
                  next: {
                    chapter: 'chapter1',
                    scene: 'void',
                    beat: 'followSound'
                  }
                }
              ]
            }
          ]
        },
        followLight: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: "Light means a way out. Let's hope that's true."
            },
            {
              type: 'narration',
              text: 'They move cautiously towards the flickering glow.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'fork',
            beat: 'lightPath'
          }
        },
        followSound: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: 'Maybe that sound is someone who can help.'
            },
            {
              type: 'narration',
              text: 'They head towards the sound, footsteps echoing.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'fork',
            beat: 'soundPath'
          }
        }
      }
    },
    fork: {
      location: 'symbolChamber',
      beats: {
        lightPath: {
          lines: [
            {
              type: 'narration',
              text: 'Alex enters a chamber illuminated by strange symbols.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'What is this place?'
            },
            {
              type: 'narration',
              text: 'A figure steps out of the shadows.'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: "You've finally arrived."
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Who are you?'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: 'A friend. Perhaps more.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'fork',
            beat: 'trustOrDoubt'
          }
        },
        soundPath: {
          lines: [
            {
              type: 'narration',
              text: 'Alex finds themselves in a corridor with flickering lights. A radio crackles nearby.'
            },
            {
              type: 'dialog',
              speaker: 'radioVoice',
              variation: 'neutral',
              noSpeakerSprite: true,
              text: 'Is someone there?'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: "Yes! I'm here! Who is this?"
            },
            {
              type: 'dialog',
              speaker: 'radioVoice',
              variation: 'neutral',
              noSpeakerSprite: true,
              text: 'Help is on the way. Trust no one.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Wait, what do you mean?'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'fork',
            beat: 'trustOrDoubt'
          }
        },
        trustOrDoubt: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: "This is getting weirder by the minute."
            },
            {
              type: 'narration',
              text: 'Footsteps approach.'
            },
            {
              type: 'dialog',
              speaker: 'stranger',
              variation: 'neutral',
              text: 'You look lost.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: "That's an understatement."
            },
            {
              type: 'dialog',
              speaker: 'stranger',
              variation: 'neutral',
              text: 'Come with me. I can help.'
            },
            {
              type: 'choice',
              text: 'What should Alex do?',
              options: [
                {
                  text: 'Trust the stranger and follow them',
                  next: {
                    chapter: 'chapter1',
                    scene: 'fork',
                    beat: 'trust'
                  }
                },
                {
                  text: 'Doubt their intentions and stay back',
                  next: {
                    chapter: 'chapter1',
                    scene: 'fork',
                    beat: 'doubt'
                  }
                }
              ]
            }
          ]
        },
        trust: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: 'Alright. Lead the way.'
            },
            {
              type: 'dialog',
              speaker: 'stranger',
              variation: 'neutral',
              text: 'Wise decision.'
            },
            {
              type: 'narration',
              text: 'They walk together down a dimly lit hallway.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'shadows',
            beat: 'exploration'
          }
        },
        doubt: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: "I think I'll manage on my own."
            },
            {
              type: 'dialog',
              speaker: 'stranger',
              variation: 'neutral',
              text: "Suit yourself. Don't say I didn't warn you."
            },
            {
              type: 'narration',
              text: 'The stranger fades into the darkness.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'shadows',
            beat: 'exploration'
          }
        }
      }
    },
    shadows: {
      location: 'corridor',
      beats: {
        exploration: {
          lines: [
            {
              type: 'narration',
              text: 'Alone, Alex continues exploring.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: "Maybe I should've gone with them."
            },
            {
              type: 'narration',
              text: 'They stumble upon a wall covered in drawings.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'thinking',
              text: 'These symbols... why do they feel familiar?'
            },
            {
              type: 'narration',
              text: 'A sudden pain flashes in their head.'
            },
            {
              type: 'dialog',
              speaker: 'whisper',
              variation: 'neutral',
              noSpeakerSprite: true,
              text: 'Remember...'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Ah! What was that?'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'shadows',
            beat: 'fightOrFlight'
          }
        },
        fightOrFlight: {
          lines: [
            {
              type: 'narration',
              text: 'A shadowy figure emerges behind them.'
            },
            {
              type: 'dialog',
              speaker: 'shadowyFigure',
              variation: 'neutral',
              text: "You shouldn't be here."
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Who are you?'
            },
            {
              type: 'dialog',
              speaker: 'shadowyFigure',
              variation: 'neutral',
              text: 'Your end.'
            },
            {
              type: 'choice',
              text: 'What should Alex do?',
              options: [
                {
                  text: 'Stand and fight',
                  next: {
                    chapter: 'chapter1',
                    scene: 'shadows',
                    beat: 'fight'
                  }
                },
                {
                  text: 'Run away',
                  next: {
                    chapter: 'chapter1',
                    scene: 'shadows',
                    beat: 'flee'
                  }
                }
              ]
            }
          ]
        },
        fight: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'angry',
              text: "I'm not afraid of you!"
            },
            {
              type: 'narration',
              text: 'They clench their fists, ready to defend themselves.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'awakening',
            beat: 'timeStop'
          }
        },
        flee: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'Nope! Not dealing with this!'
            },
            {
              type: 'narration',
              text: 'Alex turns and sprints down the corridor.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'awakening',
            beat: 'timeStop'
          }
        }
      }
    },
    awakening: {
      location: 'symbolChamber',
      beats: {
        timeStop: {
          lines: [
            {
              type: 'narration',
              text: 'Regardless of the choice, the ground trembles. Time seems to slow.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: "What's happening?"
            },
            {
              type: 'narration',
              text: 'Objects around them float as if suspended.'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: "It's awakening within you."
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'What is?'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: 'Your true power.'
            }
          ],
          next: {
            chapter: 'chapter1',
            scene: 'awakening',
            beat: 'finalChoice'
          }
        },
        finalChoice: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: 'My... power?'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: 'Yes. The ability to manipulate time itself.'
            },
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'surprised',
              text: "This can't be real."
            },
            {
              type: 'choice',
              text: 'What should Alex do?',
              options: [
                {
                  text: 'Embrace the power',
                  next: {
                    chapter: 'chapter1',
                    scene: 'awakening',
                    beat: 'embrace'
                  }
                },
                {
                  text: 'Reject the power',
                  next: {
                    chapter: 'chapter1',
                    scene: 'awakening',
                    beat: 'reject'
                  }
                }
              ]
            }
          ]
        },
        embrace: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'neutral',
              text: 'If this is real, I need to control it.'
            },
            {
              type: 'narration',
              text: 'They focus, and time begins to move normally.'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: "Good. You're beginning to understand."
            }
          ],
          next: {
            isGameOver: true
          }
        },
        reject: {
          lines: [
            {
              type: 'dialog',
              speaker: 'alex',
              variation: 'angry',
              text: "No! I won't be a part of this!"
            },
            {
              type: 'narration',
              text: 'Time snaps back, and the world feels heavier.'
            },
            {
              type: 'dialog',
              speaker: 'mysteriousFigure',
              variation: 'neutral',
              text: "Denial won't change destiny."
            }
          ],
          next: {
            isGameOver: true
          }
        }
      }
    }
  }
}
```

The other files remain unchanged as they were not part of the issue.
__________________
