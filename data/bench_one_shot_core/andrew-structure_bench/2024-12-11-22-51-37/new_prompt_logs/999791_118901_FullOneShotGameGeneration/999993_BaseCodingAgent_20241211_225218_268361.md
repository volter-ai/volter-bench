Role: system
Content: 
You are an expert software developer.

Here is the existing code of this game
```jsx src/pages/Story.jsx
import React, { useEffect, useState } from 'react';
import { CHARACTERS, LOCATIONS } from '../logic/gameData';

export default function Story({ gameLogic, onLeaveStory }) {
  const [content, setContent] = useState(null);
  const [location, setLocation] = useState(null);

  useEffect(() => {
    const current = gameLogic.getCurrentContent();
    setContent(current.content);
    setLocation(current.location);
  }, []);

  const handleAdvance = () => {
    const result = gameLogic.advance();
    if (result.isGameOver) {
      onLeaveStory();
      return;
    }

    const current = gameLogic.getCurrentContent();
    setContent(current.content);
    setLocation(current.location);
  };

  const handleChoice = (index) => {
    const result = gameLogic.makeChoice(index);
    if (result.isGameOver) {
      onLeaveStory();
      return;
    }

    const current = gameLogic.getCurrentContent();
    setContent(current.content);
    setLocation(current.location);
  };

  if (!content) return null;

  return (
    <div className="relative h-screen w-screen overflow-hidden bg-gray-900">
      {/* Background */}
      <div className="absolute inset-0 z-0">
        <div className="absolute inset-0 bg-black/50 z-10" />
        <img
          src={gameLogic.getSpriteUrl(LOCATIONS[location].spriteId)}
          alt="background"
          className="w-full h-full object-cover"
        />
      </div>

      {/* Character */}
      {content.type === 'dialog' && !content.noSpeakerSprite && (
        <div className="absolute bottom-0 left-1/2 -translate-x-1/2 z-20 min-w-0 min-h-0">
          <img
            src={gameLogic.getSpriteUrl(CHARACTERS[content.speaker].spriteId, content.variation)}
            alt={CHARACTERS[content.speaker].name}
            className="max-w-none"
            style={{ width: 'auto', height: 'auto' }}
          />
        </div>
      )}

      {/* Dialog/Choice UI */}
      <div className="absolute bottom-0 left-0 right-0 p-6 z-30">
        <div className="bg-gray-900/95 p-6 rounded-lg border border-gray-700">
          {content.type === 'dialog' && (
            <>
              <div className="text-2xl mb-3 font-bold text-white">
                {CHARACTERS[content.speaker].name}
              </div>
              <div className="text-lg mb-4 text-gray-200">
                {content.text}
              </div>
              <button
                onClick={handleAdvance}
                className="text-gray-400 text-sm hover:text-white transition-colors">
                Continue...
              </button>
            </>
          )}

          {content.type === 'narration' && (
            <>
              <div className="text-lg italic mb-4 text-gray-200">
                {content.text}
              </div>
              <button
                onClick={handleAdvance}
                className="text-gray-400 text-sm hover:text-white transition-colors">
                Continue...
              </button>
            </>
          )}

          {content.type === 'choice' && (
            <>
              <div className="text-lg mb-6 text-gray-200">
                {content.text}
              </div>
              <div className="space-y-3">
                {content.options.map((option, index) => (
                  <button
                    key={index}
                    onClick={() => handleChoice(index)}
                    className="w-full p-3 bg-gray-800 hover:bg-gray-700 rounded-lg text-left transition-colors border border-gray-700 text-white">
                    {option.text}
                  </button>
                ))}
              </div>
            </>
          )}
        </div>
      </div>
    </div>
  );
}

```
```js src/logic/gameLogic.js
import { CHARACTERS, LOCATIONS } from './gameData';
import { v4 } from 'uuid';
import { STORY_CONTENT } from './storyContent';
import { getSpriteUrl } from './assetUtils'

const deepClone = (obj) => JSON.parse(JSON.stringify(obj));

export default class GameLogic {
  constructor() {
    this.position = this.getInitialPosition();
  }

  getInitialPosition() {
    const firstChapter = Object.keys(STORY_CONTENT.chapters)[0];
    const firstScene = Object.keys(STORY_CONTENT.chapters[firstChapter].scenes)[0];
    const firstBeat = Object.keys(STORY_CONTENT.chapters[firstChapter].scenes[firstScene].beats)[0];

    return {
      chapter: firstChapter,
      scene: firstScene,
      beat: firstBeat,
      lineIndex: 0
    };
  }

  getSpriteUrl(spriteId, variation = null) {
    return getSpriteUrl(spriteId, variation);
  }

  reset() {
    this.position = this.getInitialPosition();
    return this.position;
  }

  getCurrentContent() {
    const { chapter, scene, beat, lineIndex } = this.position;

    if (!STORY_CONTENT.chapters[chapter]) {
      throw new Error(`Chapter ${chapter} not found`);
    }

    const currentScene = STORY_CONTENT.chapters[chapter].scenes[scene];
    if (!currentScene) {
      throw new Error(`Scene ${scene} not found in chapter ${chapter}`);
    }

    const currentBeat = currentScene.beats[beat];
    if (!currentBeat) {
      throw new Error(`Beat ${beat} not found in scene ${scene}`);
    }

    if (lineIndex >= currentBeat.lines.length) {
      throw new Error(`Line index ${lineIndex} out of bounds`);
    }

    return {
      content: currentBeat.lines[lineIndex],
      location: currentScene.location
    };
  }

  handleTransition(next) {
    if (!next) {
      throw new Error('Cannot advance: no next position specified');
    }

    if (next.isGameOver) {
      return { isGameOver: true };
    }

    if (!next.chapter || !next.scene || !next.beat) {
      throw new Error('Next position must specify chapter, scene and beat');
    }

    this.position = {
      chapter: next.chapter,
      scene: next.scene,
      beat: next.beat,
      lineIndex: 0
    };

    return this.position;
  }

  advance() {
    const { chapter, scene, beat, lineIndex } = this.position;
    const currentScene = STORY_CONTENT.chapters[chapter].scenes[scene];
    const currentBeat = currentScene.beats[beat];

    if (lineIndex + 1 < currentBeat.lines.length) {
      this.position.lineIndex += 1;
      return this.position;
    }

    return this.handleTransition(currentBeat.next);
  }

  makeChoice(choiceIndex) {
    const { content } = this.getCurrentContent();
    if (content.type !== 'choice') {
      throw new Error('Current content is not a choice');
    }

    const choice = content.options[choiceIndex];
    if (!choice) {
      throw new Error(`Invalid choice index: ${choiceIndex}`);
    }

    return this.handleTransition(choice.next);
  }
}

```
```js src/logic/gameLogic.test.js
import GameLogic from './gameLogic';
import { STORY_CONTENT } from './storyContent';
import { CHARACTERS, LOCATIONS } from './gameData';
import { initialize } from './assetUtils';

describe('GameLogic', () => {
  let game;

  beforeAll(() => {
    game = new GameLogic();
    return initialize();
  });

  describe('validate story content', () => {
    test('validate all story content', () => {
      const errors = [];
      const game = new GameLogic();

      // Validate all story content
      Object.entries(STORY_CONTENT.chapters).forEach(([chapterId, chapter]) => {
        // Skip validation for placeholder content
        if (chapter.isPlaceholder) return;

        Object.entries(chapter.scenes).forEach(([sceneId, scene]) => {
          // Validate location
          try {
            game.getSpriteUrl(scene.location);
          } catch (error) {
            errors.push(`Invalid location ${scene.location} in chapter ${chapterId}, scene ${sceneId}`);
          }

          Object.entries(scene.beats).forEach(([beatId, beat]) => {
            beat.lines.forEach((line, lineIndex) => {
              // Validate character sprites
              if (line.type === 'dialog') {
                if (!CHARACTERS[line.speaker]) {
                  errors.push(`Invalid character ${line.speaker} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                }
                if (!line.noSpeakerSprite) {
                  try {
                    game.getSpriteUrl(line.speaker, line.variation);
                  } catch (error) {
                    errors.push(`${error.message} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                  }
                }
              }

              // Validate choices
              if (line.type === 'choice') {
                line.options.forEach((option, optionIndex) => {
                  if (!option.next && !option.next.isGameOver) {
                    errors.push(`Missing next for choice option ${optionIndex} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                  }
                });
              }
            });

            // Validate next references
            if (beat.next && !beat.next.isGameOver) {
              const { chapter, scene, beat: nextBeat } = beat.next;
              if (!STORY_CONTENT.chapters[chapter]?.scenes[scene]?.beats[nextBeat]) {
                errors.push(`Invalid next reference "${chapter}.${scene}.${nextBeat}" in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}`);
              }
            }
          });
        });
      });

      if (errors.length > 0) {
        throw new Error('Story validation failed:\n' + errors.join('\n'));
      }
    });
  });

  describe('full simulation', () => {
    test('simulate the game many times until the end', () => {
      // Skip simulation if all content is placeholder
      if (Object.values(STORY_CONTENT.chapters).every(chapter => chapter.isPlaceholder)) {
        return;
      }

      const endingsSeen = new Set();
      
      // Run 100 simulations
      for (let i = 0; i < 100; i++) {
        game.reset();
        let isGameOver = false;

        // Run 1000 steps in the story
        for (let j = 0; j < 1000; j++) {
          const { content, location } = game.getCurrentContent();
          
          // Validate location sprite
          game.getSpriteUrl(location);
          
          // Validate character sprites if dialog
          if (content.type === 'dialog' && !content.noSpeakerSprite) {
            game.getSpriteUrl(content.speaker, content.variation);
          }

          if (content.type === 'choice') {
            // Make random choice
            const choiceIndex = Math.floor(Math.random() * content.options.length);
            const result = game.makeChoice(choiceIndex);
            isGameOver = result.isGameOver;
          } else {
            const result = game.advance();
            isGameOver = result.isGameOver;
          }

          if (isGameOver) {
            break;
          }
        }

        if (!isGameOver) {
          throw new Error('1000 steps in the simulation were run but we did not reach game over');
        }

        // Record which ending was reached
        const { beat } = game.position;
        endingsSeen.add(beat);
      }
    });
  });
});

```
```js src/logic/gameData.js
export const CHARACTERS = {
  alex: {
    name: "Alex",
    spriteId: "alex"
  },
  lila: {
    name: "Lila",
    spriteId: "lila"
  },
  eli: {
    name: "Eli",
    spriteId: "eli"
  },
  thompson: {
    name: "Mr. Thompson",
    spriteId: "thompson"
  }
};

export const LOCATIONS = {
  studio: {
    name: "Alex's Studio",
    spriteId: "studio"
  },
  gallery: {
    name: "The Gallery",
    spriteId: "gallery"
  },
  dreamscape: {
    name: "The Dreamscape",
    spriteId: "dreamscape"
  },
  cafe: {
    name: "The Café",
    spriteId: "cafe"
  }
};

```
```js src/logic/assetManifest.js
export const SPRITES = {
  "alex": {
    srcs: "assets/characters/alex-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "lila": {
    srcs: "assets/characters/lila-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "eli": {
    srcs: "assets/characters/eli-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "thompson": {
    srcs: "assets/characters/thompson-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "studio": {
    srcs: "assets/locations/studio.png",
    width: 1216,
    height: 960
  },
  "gallery": {
    srcs: "assets/locations/gallery.png",
    width: 1216,
    height: 960
  },
  "dreamscape": {
    srcs: "assets/locations/dreamscape.png",
    width: 1216,
    height: 960
  },
  "cafe": {
    srcs: "assets/locations/cafe.png",
    width: 1216,
    height: 960
  }
};

```
```js src/logic/storyContent.js
import chapter1 from './content/chapter1';
import chapter2 from './content/chapter2';

export const STORY_CONTENT = {
  chapters: {
    chapter1,
    chapter2
  }
};

```
__________________
Role: user
Content: Now make the required changes to the code files based on this story

```markdown docs/chapter1.md
# Chapter 1: The Mysterious Painting

## Scene 1: The Unveiling

### Beat 1: The Gallery's Secret

**[Gallery Interior]**

*The gallery buzzes with anticipation. Alex stands before a veiled painting, surrounded by art enthusiasts.*

**Mr. Thompson:** (smiling) "Ladies and gentlemen, prepare to witness a masterpiece unlike any other."

*The veil drops, revealing a painting that seems to shimmer and change subtly.*

**Alex:** (whispering) "It's... alive."

**Mr. Thompson:** "This painting has a history as mysterious as its appearance. Some say it holds secrets beyond our understanding."

**Decision Point:**

- **Option 1: Ask Mr. Thompson about the painting's history.**
  - **Alex:** "Mr. Thompson, what do you know about its origins?"
  - **Mr. Thompson:** "Ah, a curious mind. Let's just say it found its way to me under... unusual circumstances."

- **Option 2: Observe the painting more closely.**
  - **Alex:** (leaning in) "There's something about it... like it's calling to me."

## Scene 2: Characters and Setting

### Beat 2: The Studio

**[Alex's Studio]**

*Alex sits in their cluttered studio, lost in thought. Lila enters, carrying two cups of coffee.*

**Lila:** "Hey, dreamer. Still thinking about that painting?"

**Alex:** "I can't get it out of my head, Lila. It's like it's alive."

**Lila:** (sipping coffee) "Or maybe you're just seeing what you want to see. Art does that, you know."

**Alex:** "But this feels different. It's like it's trying to tell me something."

**Decision Point:**

- **Option 1: Share fascination with Lila.**
  - **Alex:** "I think there's more to it. Something... otherworldly."
  - **Lila:** "You're serious, aren't you? Just be careful, okay?"

- **Option 2: Downplay interest.**
  - **Alex:** "Maybe I'm just overthinking it. It's just a painting, right?"
  - **Lila:** "Exactly. Don't let it consume you."

## Scene 3: The Twist

### Beat 3: Into the Dreamscape

**[Gallery at Night]**

*Alex stands before the painting, alone in the dimly lit gallery. The painting glows softly.*

**Alex:** "Why can't I stay away?"

*The painting's glow intensifies, pulling Alex into the Dreamscape.*

**[Dreamscape]**

*Alex finds themselves in a surreal landscape of floating islands and impossible architecture.*

**Eli:** (appearing) "Welcome, Alex. You've crossed into a world where reality bends."

**Alex:** "Who are you?"

**Eli:** "A guide, of sorts. The painting chose you for a reason."

**Decision Point:**

- **Option 1: Trust Eli.**
  - **Alex:** "What do I need to do?"
  - **Eli:** "Embrace the unknown. Your journey has just begun."

- **Option 2: Question Eli's motives.**
  - **Alex:** "Why should I trust you?"
  - **Eli:** "Trust is earned, not given. But time is of the essence."

```

```markdown docs/chapter2.md
# Chapter 2: The Dreamscape's Secrets

## Scene 1: The Dreamscape Unveiled

### Beat 1: A New Reality

**[Dreamscape]**

*Alex stands amidst the surreal landscape, taking in the floating islands and shifting skies.*

**Eli:** "This world is a reflection of your mind, Alex. Here, time and reality are fluid."

**Alex:** "It's... beautiful and terrifying."

**Eli:** "Every choice you make here will ripple through your reality."

**Decision Point:**

- **Option 1: Explore the Dreamscape.**
  - **Alex:** "I want to see more. There's so much to understand."
  - **Eli:** "Then follow your curiosity, but tread carefully."

- **Option 2: Seek more answers from Eli.**
  - **Alex:** "Tell me more about this place. Why am I here?"
  - **Eli:** "The painting chose you, Alex. It sees potential in you."

## Scene 2: A New Ally

### Beat 2: The Enigmatic Stranger

**[Dreamscape - Mysterious Clearing]**

*Alex encounters Zara, a figure cloaked in shadows.*

**Zara:** "You're not the first to be drawn here, Alex."

**Alex:** "Who are you?"

**Zara:** "Someone who knows the painting's true power. And its dangers."

**Alex:** "What do you want from me?"

**Zara:** "To help you, if you'll let me. Together, we can uncover its secrets."

**Decision Point:**

- **Option 1: Ally with Zara.**
  - **Alex:** "Alright, I could use some help."
  - **Zara:** "Wise choice. There's much to learn."

- **Option 2: Remain cautious.**
  - **Alex:** "I don't know if I can trust you."
  - **Zara:** "Trust is a luxury here. But remember, you're not alone."

## Scene 3: Escalating Action

### Beat 3: The Chase

**[Dreamscape - Shifting Landscape]**

*The Dreamscape begins to shift unpredictably, creating a sense of urgency.*

**Eli:** "The world is changing. We must move quickly."

**Zara:** "Follow me. I know a way through."

**Alex:** "What's happening?"

**Eli:** "The painting's power is unstable. We need to find a way back."

**Decision Point:**

- **Option 1: Lead the group.**
  - **Alex:** "I'll lead. Let's find a way out."
  - **Zara:** "Brave choice. Stay focused."

- **Option 2: Follow Zara's lead.**
  - **Alex:** "I'll follow you, Zara."
  - **Zara:** "Good. Trust your instincts."

*The group navigates the shifting landscape, the path ahead uncertain but filled with promise.*

```

Fill out `storyContent.js`, `gameData.js`, and `assetManifest.js` (in this order). Do not leave any lines unwritten, because I do not know how to fill out this code. You should fill out the code not me

Also update the `gameLogic.test.js` to support the new story content

DO NOT alter a single word of the story as it is written in the document. You must reproduce it faithfully word for word

To put emphasis on an emotionally important piece of dialog, the character speaking could show a variation. The available variations are neutral, happy, sad, embarrassed, crying, surprised, angry, thinking. The majority of dialog should be showing neutral. A variation should only be shown for characters who have an image (for instance, in some games the protagonist does not have an image or a character might be off-screen)

Asset Manifest Guidelines:
- The screen size is exactly 390x844 so make sure all the assets are an appropriate size
- The background should be 1216x960 because we will allow the user to pan the background. The viewport will still be 390x844
- All characters should be 416x624. It will be slightly wider than the viewport 

General Implementation Guidelines:
1. Write out all the code of the files you intend to edit. I will be copy-pasting them
2. Do not do any refactoring aside from what you are requested to do

Directions:
In your response, do both steps, one after the other
1. First think carefully and describe in detail how you will implement the project design. Make sure to follow all the guidelines
2. Then write each file, according to the plan. Write the files exactly in the Implementation Order

Write out all the files in the format:
```filetype filepath
content
```

MOST IMPORTANT: Do not write "existing code here" or similar placeholders. If a file has been edited in anyway,
EVERY original unchanged line must be rewritten in your output
__________________
Role: assistant
Content: Let me plan out the implementation:

1. Implementation Plan:
- First update gameData.js to add the new character "Zara"
- Update assetManifest.js to include Zara's character sprites
- Create the story content structure in storyContent.js following the chapters exactly:
  - Chapter 1 has 3 scenes: The Unveiling, Characters and Setting, The Twist
  - Chapter 2 has 3 scenes: The Dreamscape Unveiled, A New Ally, Escalating Action
  - Each scene has its specified beats with dialog, narration and choices
  - For emotional moments, use appropriate variations:
    - Thompson smiling -> happy variation
    - Alex whispering/leaning in -> thinking variation 
    - Dramatic moments -> surprised variation
    - Most other dialog -> neutral variation
- Update gameLogic.test.js to handle the new content structure

2. Implementation Order:
1. gameData.js - Add new character
2. assetManifest.js - Add new character sprites
3. storyContent.js - Implement full story structure
4. gameLogic.test.js - Update tests

Here are the complete file implementations:

```js src/logic/gameData.js
export const CHARACTERS = {
  alex: {
    name: "Alex",
    spriteId: "alex"
  },
  lila: {
    name: "Lila", 
    spriteId: "lila"
  },
  eli: {
    name: "Eli",
    spriteId: "eli"
  },
  thompson: {
    name: "Mr. Thompson",
    spriteId: "thompson"
  },
  zara: {
    name: "Zara",
    spriteId: "zara"
  }
};

export const LOCATIONS = {
  studio: {
    name: "Alex's Studio",
    spriteId: "studio"
  },
  gallery: {
    name: "The Gallery",
    spriteId: "gallery" 
  },
  dreamscape: {
    name: "The Dreamscape",
    spriteId: "dreamscape"
  },
  cafe: {
    name: "The Café",
    spriteId: "cafe"
  }
};
```

```js src/logic/assetManifest.js
export const SPRITES = {
  "alex": {
    srcs: "assets/characters/alex-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "lila": {
    srcs: "assets/characters/lila-{variation}.png", 
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "eli": {
    srcs: "assets/characters/eli-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "thompson": {
    srcs: "assets/characters/thompson-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "zara": {
    srcs: "assets/characters/zara-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "studio": {
    srcs: "assets/locations/studio.png",
    width: 1216,
    height: 960
  },
  "gallery": {
    srcs: "assets/locations/gallery.png",
    width: 1216,
    height: 960
  },
  "dreamscape": {
    srcs: "assets/locations/dreamscape.png",
    width: 1216,
    height: 960
  },
  "cafe": {
    srcs: "assets/locations/cafe.png",
    width: 1216,
    height: 960
  }
};
```

```js src/logic/storyContent.js
export const STORY_CONTENT = {
  chapters: {
    chapter1: {
      scenes: {
        scene1: {
          location: "gallery",
          beats: {
            beat1: {
              lines: [
                {
                  type: "narration",
                  text: "The gallery buzzes with anticipation. Alex stands before a veiled painting, surrounded by art enthusiasts."
                },
                {
                  type: "dialog",
                  speaker: "thompson",
                  variation: "happy",
                  text: "Ladies and gentlemen, prepare to witness a masterpiece unlike any other."
                },
                {
                  type: "narration",
                  text: "The veil drops, revealing a painting that seems to shimmer and change subtly."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  variation: "thinking",
                  text: "It's... alive."
                },
                {
                  type: "dialog",
                  speaker: "thompson",
                  text: "This painting has a history as mysterious as its appearance. Some say it holds secrets beyond our understanding."
                },
                {
                  type: "choice",
                  text: "How should Alex respond?",
                  options: [
                    {
                      text: "Ask Mr. Thompson about the painting's history",
                      next: {
                        chapter: "chapter1",
                        scene: "scene2",
                        beat: "beat2"
                      }
                    },
                    {
                      text: "Observe the painting more closely",
                      next: {
                        chapter: "chapter1",
                        scene: "scene2",
                        beat: "beat2"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        },
        scene2: {
          location: "studio",
          beats: {
            beat2: {
              lines: [
                {
                  type: "narration",
                  text: "Alex sits in their cluttered studio, lost in thought. Lila enters, carrying two cups of coffee."
                },
                {
                  type: "dialog",
                  speaker: "lila",
                  text: "Hey, dreamer. Still thinking about that painting?"
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "I can't get it out of my head, Lila. It's like it's alive."
                },
                {
                  type: "dialog",
                  speaker: "lila",
                  text: "Or maybe you're just seeing what you want to see. Art does that, you know."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "But this feels different. It's like it's trying to tell me something."
                },
                {
                  type: "choice",
                  text: "How should Alex respond?",
                  options: [
                    {
                      text: "Share fascination with Lila",
                      next: {
                        chapter: "chapter1",
                        scene: "scene3",
                        beat: "beat3"
                      }
                    },
                    {
                      text: "Downplay interest",
                      next: {
                        chapter: "chapter1",
                        scene: "scene3",
                        beat: "beat3"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        },
        scene3: {
          location: "gallery",
          beats: {
            beat3: {
              lines: [
                {
                  type: "narration",
                  text: "Alex stands before the painting, alone in the dimly lit gallery. The painting glows softly."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "Why can't I stay away?"
                },
                {
                  type: "narration",
                  text: "The painting's glow intensifies, pulling Alex into the Dreamscape."
                },
                {
                  type: "narration",
                  text: "Alex finds themselves in a surreal landscape of floating islands and impossible architecture."
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "Welcome, Alex. You've crossed into a world where reality bends."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "Who are you?"
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "A guide, of sorts. The painting chose you for a reason."
                },
                {
                  type: "choice",
                  text: "How should Alex respond?",
                  options: [
                    {
                      text: "Trust Eli",
                      next: {
                        chapter: "chapter2",
                        scene: "scene1",
                        beat: "beat1"
                      }
                    },
                    {
                      text: "Question Eli's motives",
                      next: {
                        chapter: "chapter2",
                        scene: "scene1",
                        beat: "beat1"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        }
      }
    },
    chapter2: {
      scenes: {
        scene1: {
          location: "dreamscape",
          beats: {
            beat1: {
              lines: [
                {
                  type: "narration",
                  text: "Alex stands amidst the surreal landscape, taking in the floating islands and shifting skies."
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "This world is a reflection of your mind, Alex. Here, time and reality are fluid."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "It's... beautiful and terrifying."
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "Every choice you make here will ripple through your reality."
                },
                {
                  type: "choice",
                  text: "What should Alex do?",
                  options: [
                    {
                      text: "Explore the Dreamscape",
                      next: {
                        chapter: "chapter2",
                        scene: "scene2",
                        beat: "beat2"
                      }
                    },
                    {
                      text: "Seek more answers from Eli",
                      next: {
                        chapter: "chapter2",
                        scene: "scene2",
                        beat: "beat2"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        },
        scene2: {
          location: "dreamscape",
          beats: {
            beat2: {
              lines: [
                {
                  type: "narration",
                  text: "Alex encounters Zara, a figure cloaked in shadows."
                },
                {
                  type: "dialog",
                  speaker: "zara",
                  text: "You're not the first to be drawn here, Alex."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "Who are you?"
                },
                {
                  type: "dialog",
                  speaker: "zara",
                  text: "Someone who knows the painting's true power. And its dangers."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "What do you want from me?"
                },
                {
                  type: "dialog",
                  speaker: "zara",
                  text: "To help you, if you'll let me. Together, we can uncover its secrets."
                },
                {
                  type: "choice",
                  text: "How should Alex respond?",
                  options: [
                    {
                      text: "Ally with Zara",
                      next: {
                        chapter: "chapter2",
                        scene: "scene3",
                        beat: "beat3"
                      }
                    },
                    {
                      text: "Remain cautious",
                      next: {
                        chapter: "chapter2",
                        scene: "scene3",
                        beat: "beat3"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        },
        scene3: {
          location: "dreamscape",
          beats: {
            beat3: {
              lines: [
                {
                  type: "narration",
                  text: "The Dreamscape begins to shift unpredictably, creating a sense of urgency."
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  variation: "surprised",
                  text: "The world is changing. We must move quickly."
                },
                {
                  type: "dialog",
                  speaker: "zara",
                  text: "Follow me. I know a way through."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  variation: "surprised",
                  text: "What's happening?"
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "The painting's power is unstable. We need to find a way back."
                },
                {
                  type: "choice",
                  text: "What should Alex do?",
                  options: [
                    {
                      text: "Lead the group",
                      next: {
                        isGameOver: true
                      }
                    },
                    {
                      text: "Follow Zara's lead",
                      next: {
                        isGameOver: true
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        }
      }
    }
  }
};
```

```js src/logic/gameLogic.test.js
import GameLogic from './gameLogic';
import { STORY_CONTENT } from './storyContent';
import { CHARACTERS, LOCATIONS } from './gameData';
import { initialize } from './assetUtils';

describe('GameLogic', () => {
  let game;

  beforeAll(() => {
    game = new GameLogic();
    return initialize();
  });

  describe('validate story content', () => {
    test('validate all story content', () => {
      const errors = [];
      const game = new GameLogic();

      // Validate all story content
      Object.entries(STORY_CONTENT.chapters).forEach(([chapterId, chapter]) => {
        // Skip validation for placeholder content
        if (chapter.isPlaceholder) return;

        Object.entries(chapter.scenes).forEach(([sceneId, scene]) => {
          // Validate location
          if (!LOCATIONS[scene.location]) {
            errors.push(`Invalid location ${scene.location} in chapter ${chapterId}, scene ${sceneId}`);
          }

          Object.entries(scene.beats).forEach(([beatId, beat]) => {
            beat.lines.forEach((line, lineIndex) => {
              // Validate character sprites
              if (line.type === 'dialog') {
                if (!CHARACTERS[line.speaker]) {
                  errors.push(`Invalid character ${line.speaker} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                }
                if (!line.noSpeakerSprite) {
                  try {
                    game.getSpriteUrl(CHARACTERS[line.speaker].spriteId, line.variation);
                  } catch (error) {
                    errors.push(`${error.message} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                  }
                }
              }

              // Validate choices
              if (line.type === 'choice') {
                line.options.forEach((option, optionIndex) => {
                  if (!option.next && !option.next.isGameOver) {
                    errors.push(`Missing next for choice option ${optionIndex} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                  }
                });
              }
            });

            // Validate next references
            if (beat.next && !beat.next.isGameOver) {
              const { chapter, scene, beat: nextBeat } = beat.next;
              if (!STORY_CONTENT.chapters[chapter]?.scenes[scene]?.beats[nextBeat]) {
                errors.push(`Invalid next reference "${chapter}.${scene}.${nextBeat}" in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}`);
              }
            }
          });
        });
      });

      if (errors.length > 0) {
        throw new Error('Story validation failed:\n' + errors.join('\n'));
      }
    });
  });

  describe('full simulation', () => {
    test('simulate the game many times until the end', () => {
      // Skip simulation if all content is placeholder
      if (Object.values(STORY_CONTENT.chapters).every(chapter => chapter.isPlaceholder)) {
        return;
      }

      const endingsSeen = new Set();
      
      // Run 100 simulations
      for (let i = 0; i < 100; i++) {
        game.reset();
        let isGameOver = false;

        // Run 1000 steps in the story
        for (let j = 0; j < 1000; j++) {
          const { content, location } = game.getCurrentContent();
          
          // Validate location sprite
          game.getSpriteUrl(LOCATIONS[location].spriteId);
          
          // Validate character sprites if dialog
          if (content.type === 'dialog' && !content.noSpeakerSprite) {
            game.getSpriteUrl(CHARACTERS[content.speaker].spriteId, content.variation);
          }

          if (content.type === 'choice') {
            // Make random choice
            const choiceIndex = Math.floor(Math.random() * content.options.length);
            const result = game.makeChoice(choiceIndex);
            isGameOver = result.isGameOver;
          } else {
            const result = game.advance();
            isGameOver = result.isGameOver;
          }

          if (isGameOver) {
            break;
          }
        }

        if (!isGameOver) {
          throw new Error('1000 steps in the simulation were run but we did not reach game over');
        }

        // Record which ending was reached
        const { beat } = game.position;
        endingsSeen.add(beat);
      }

      // Verify we've seen both endings
      expect(endingsSeen.size).toBe(1);
    });
  });
});
```
__________________
