Role: system
Content: You are a helpful assistant specialized in changing files based on proposed changes.
__________________
Role: user
Content: ## Proposed Code Change
Let me plan out the implementation:

1. Implementation Plan:
- First update gameData.js to add the new character "Zara"
- Update assetManifest.js to include Zara's character sprites
- Create the story content structure in storyContent.js following the chapters exactly:
  - Chapter 1 has 3 scenes: The Unveiling, Characters and Setting, The Twist
  - Chapter 2 has 3 scenes: The Dreamscape Unveiled, A New Ally, Escalating Action
  - Each scene has its specified beats with dialog, narration and choices
  - For emotional moments, use appropriate variations:
    - Thompson smiling -> happy variation
    - Alex whispering/leaning in -> thinking variation 
    - Dramatic moments -> surprised variation
    - Most other dialog -> neutral variation
- Update gameLogic.test.js to handle the new content structure

2. Implementation Order:
1. gameData.js - Add new character
2. assetManifest.js - Add new character sprites
3. storyContent.js - Implement full story structure
4. gameLogic.test.js - Update tests

Here are the complete file implementations:

# Excerpt ID: 80416044-5864-4c93-826d-99c403fbf8b6
```js src/logic/gameData.js
export const CHARACTERS = {
  alex: {
    name: "Alex",
    spriteId: "alex"
  },
  lila: {
    name: "Lila", 
    spriteId: "lila"
  },
  eli: {
    name: "Eli",
    spriteId: "eli"
  },
  thompson: {
    name: "Mr. Thompson",
    spriteId: "thompson"
  },
  zara: {
    name: "Zara",
    spriteId: "zara"
  }
};

export const LOCATIONS = {
  studio: {
    name: "Alex's Studio",
    spriteId: "studio"
  },
  gallery: {
    name: "The Gallery",
    spriteId: "gallery" 
  },
  dreamscape: {
    name: "The Dreamscape",
    spriteId: "dreamscape"
  },
  cafe: {
    name: "The Caf√©",
    spriteId: "cafe"
  }
};
```

# Excerpt ID: deb70cca-5a55-4ec7-8653-fc58beaf010e
```js src/logic/assetManifest.js
export const SPRITES = {
  "alex": {
    srcs: "assets/characters/alex-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "lila": {
    srcs: "assets/characters/lila-{variation}.png", 
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "eli": {
    srcs: "assets/characters/eli-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "thompson": {
    srcs: "assets/characters/thompson-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "zara": {
    srcs: "assets/characters/zara-{variation}.png",
    variations: ['neutral', 'happy', 'sad', 'embarrassed', 'crying', 'surprised', 'angry', 'thinking'],
    width: 416,
    height: 624
  },
  "studio": {
    srcs: "assets/locations/studio.png",
    width: 1216,
    height: 960
  },
  "gallery": {
    srcs: "assets/locations/gallery.png",
    width: 1216,
    height: 960
  },
  "dreamscape": {
    srcs: "assets/locations/dreamscape.png",
    width: 1216,
    height: 960
  },
  "cafe": {
    srcs: "assets/locations/cafe.png",
    width: 1216,
    height: 960
  }
};
```

# Excerpt ID: ba355d81-2b4f-482e-bf29-b2b0cb58288b
```js src/logic/storyContent.js
export const STORY_CONTENT = {
  chapters: {
    chapter1: {
      scenes: {
        scene1: {
          location: "gallery",
          beats: {
            beat1: {
              lines: [
                {
                  type: "narration",
                  text: "The gallery buzzes with anticipation. Alex stands before a veiled painting, surrounded by art enthusiasts."
                },
                {
                  type: "dialog",
                  speaker: "thompson",
                  variation: "happy",
                  text: "Ladies and gentlemen, prepare to witness a masterpiece unlike any other."
                },
                {
                  type: "narration",
                  text: "The veil drops, revealing a painting that seems to shimmer and change subtly."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  variation: "thinking",
                  text: "It's... alive."
                },
                {
                  type: "dialog",
                  speaker: "thompson",
                  text: "This painting has a history as mysterious as its appearance. Some say it holds secrets beyond our understanding."
                },
                {
                  type: "choice",
                  text: "How should Alex respond?",
                  options: [
                    {
                      text: "Ask Mr. Thompson about the painting's history",
                      next: {
                        chapter: "chapter1",
                        scene: "scene2",
                        beat: "beat2"
                      }
                    },
                    {
                      text: "Observe the painting more closely",
                      next: {
                        chapter: "chapter1",
                        scene: "scene2",
                        beat: "beat2"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        },
        scene2: {
          location: "studio",
          beats: {
            beat2: {
              lines: [
                {
                  type: "narration",
                  text: "Alex sits in their cluttered studio, lost in thought. Lila enters, carrying two cups of coffee."
                },
                {
                  type: "dialog",
                  speaker: "lila",
                  text: "Hey, dreamer. Still thinking about that painting?"
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "I can't get it out of my head, Lila. It's like it's alive."
                },
                {
                  type: "dialog",
                  speaker: "lila",
                  text: "Or maybe you're just seeing what you want to see. Art does that, you know."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "But this feels different. It's like it's trying to tell me something."
                },
                {
                  type: "choice",
                  text: "How should Alex respond?",
                  options: [
                    {
                      text: "Share fascination with Lila",
                      next: {
                        chapter: "chapter1",
                        scene: "scene3",
                        beat: "beat3"
                      }
                    },
                    {
                      text: "Downplay interest",
                      next: {
                        chapter: "chapter1",
                        scene: "scene3",
                        beat: "beat3"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        },
        scene3: {
          location: "gallery",
          beats: {
            beat3: {
              lines: [
                {
                  type: "narration",
                  text: "Alex stands before the painting, alone in the dimly lit gallery. The painting glows softly."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "Why can't I stay away?"
                },
                {
                  type: "narration",
                  text: "The painting's glow intensifies, pulling Alex into the Dreamscape."
                },
                {
                  type: "narration",
                  text: "Alex finds themselves in a surreal landscape of floating islands and impossible architecture."
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "Welcome, Alex. You've crossed into a world where reality bends."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "Who are you?"
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "A guide, of sorts. The painting chose you for a reason."
                },
                {
                  type: "choice",
                  text: "How should Alex respond?",
                  options: [
                    {
                      text: "Trust Eli",
                      next: {
                        chapter: "chapter2",
                        scene: "scene1",
                        beat: "beat1"
                      }
                    },
                    {
                      text: "Question Eli's motives",
                      next: {
                        chapter: "chapter2",
                        scene: "scene1",
                        beat: "beat1"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        }
      }
    },
    chapter2: {
      scenes: {
        scene1: {
          location: "dreamscape",
          beats: {
            beat1: {
              lines: [
                {
                  type: "narration",
                  text: "Alex stands amidst the surreal landscape, taking in the floating islands and shifting skies."
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "This world is a reflection of your mind, Alex. Here, time and reality are fluid."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "It's... beautiful and terrifying."
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "Every choice you make here will ripple through your reality."
                },
                {
                  type: "choice",
                  text: "What should Alex do?",
                  options: [
                    {
                      text: "Explore the Dreamscape",
                      next: {
                        chapter: "chapter2",
                        scene: "scene2",
                        beat: "beat2"
                      }
                    },
                    {
                      text: "Seek more answers from Eli",
                      next: {
                        chapter: "chapter2",
                        scene: "scene2",
                        beat: "beat2"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        },
        scene2: {
          location: "dreamscape",
          beats: {
            beat2: {
              lines: [
                {
                  type: "narration",
                  text: "Alex encounters Zara, a figure cloaked in shadows."
                },
                {
                  type: "dialog",
                  speaker: "zara",
                  text: "You're not the first to be drawn here, Alex."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "Who are you?"
                },
                {
                  type: "dialog",
                  speaker: "zara",
                  text: "Someone who knows the painting's true power. And its dangers."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  text: "What do you want from me?"
                },
                {
                  type: "dialog",
                  speaker: "zara",
                  text: "To help you, if you'll let me. Together, we can uncover its secrets."
                },
                {
                  type: "choice",
                  text: "How should Alex respond?",
                  options: [
                    {
                      text: "Ally with Zara",
                      next: {
                        chapter: "chapter2",
                        scene: "scene3",
                        beat: "beat3"
                      }
                    },
                    {
                      text: "Remain cautious",
                      next: {
                        chapter: "chapter2",
                        scene: "scene3",
                        beat: "beat3"
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        },
        scene3: {
          location: "dreamscape",
          beats: {
            beat3: {
              lines: [
                {
                  type: "narration",
                  text: "The Dreamscape begins to shift unpredictably, creating a sense of urgency."
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  variation: "surprised",
                  text: "The world is changing. We must move quickly."
                },
                {
                  type: "dialog",
                  speaker: "zara",
                  text: "Follow me. I know a way through."
                },
                {
                  type: "dialog",
                  speaker: "alex",
                  variation: "surprised",
                  text: "What's happening?"
                },
                {
                  type: "dialog",
                  speaker: "eli",
                  text: "The painting's power is unstable. We need to find a way back."
                },
                {
                  type: "choice",
                  text: "What should Alex do?",
                  options: [
                    {
                      text: "Lead the group",
                      next: {
                        isGameOver: true
                      }
                    },
                    {
                      text: "Follow Zara's lead",
                      next: {
                        isGameOver: true
                      }
                    }
                  ]
                }
              ],
              next: null
            }
          }
        }
      }
    }
  }
};
```

# Excerpt ID: 021b6551-7f65-4303-bbed-2880f066e057
```js src/logic/gameLogic.test.js
import GameLogic from './gameLogic';
import { STORY_CONTENT } from './storyContent';
import { CHARACTERS, LOCATIONS } from './gameData';
import { initialize } from './assetUtils';

describe('GameLogic', () => {
  let game;

  beforeAll(() => {
    game = new GameLogic();
    return initialize();
  });

  describe('validate story content', () => {
    test('validate all story content', () => {
      const errors = [];
      const game = new GameLogic();

      // Validate all story content
      Object.entries(STORY_CONTENT.chapters).forEach(([chapterId, chapter]) => {
        // Skip validation for placeholder content
        if (chapter.isPlaceholder) return;

        Object.entries(chapter.scenes).forEach(([sceneId, scene]) => {
          // Validate location
          if (!LOCATIONS[scene.location]) {
            errors.push(`Invalid location ${scene.location} in chapter ${chapterId}, scene ${sceneId}`);
          }

          Object.entries(scene.beats).forEach(([beatId, beat]) => {
            beat.lines.forEach((line, lineIndex) => {
              // Validate character sprites
              if (line.type === 'dialog') {
                if (!CHARACTERS[line.speaker]) {
                  errors.push(`Invalid character ${line.speaker} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                }
                if (!line.noSpeakerSprite) {
                  try {
                    game.getSpriteUrl(CHARACTERS[line.speaker].spriteId, line.variation);
                  } catch (error) {
                    errors.push(`${error.message} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                  }
                }
              }

              // Validate choices
              if (line.type === 'choice') {
                line.options.forEach((option, optionIndex) => {
                  if (!option.next && !option.next.isGameOver) {
                    errors.push(`Missing next for choice option ${optionIndex} in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}, line ${lineIndex}`);
                  }
                });
              }
            });

            // Validate next references
            if (beat.next && !beat.next.isGameOver) {
              const { chapter, scene, beat: nextBeat } = beat.next;
              if (!STORY_CONTENT.chapters[chapter]?.scenes[scene]?.beats[nextBeat]) {
                errors.push(`Invalid next reference "${chapter}.${scene}.${nextBeat}" in chapter ${chapterId}, scene ${sceneId}, beat ${beatId}`);
              }
            }
          });
        });
      });

      if (errors.length > 0) {
        throw new Error('Story validation failed:\n' + errors.join('\n'));
      }
    });
  });

  describe('full simulation', () => {
    test('simulate the game many times until the end', () => {
      // Skip simulation if all content is placeholder
      if (Object.values(STORY_CONTENT.chapters).every(chapter => chapter.isPlaceholder)) {
        return;
      }

      const endingsSeen = new Set();
      
      // Run 100 simulations
      for (let i = 0; i < 100; i++) {
        game.reset();
        let isGameOver = false;

        // Run 1000 steps in the story
        for (let j = 0; j < 1000; j++) {
          const { content, location } = game.getCurrentContent();
          
          // Validate location sprite
          game.getSpriteUrl(LOCATIONS[location].spriteId);
          
          // Validate character sprites if dialog
          if (content.type === 'dialog' && !content.noSpeakerSprite) {
            game.getSpriteUrl(CHARACTERS[content.speaker].spriteId, content.variation);
          }

          if (content.type === 'choice') {
            // Make random choice
            const choiceIndex = Math.floor(Math.random() * content.options.length);
            const result = game.makeChoice(choiceIndex);
            isGameOver = result.isGameOver;
          } else {
            const result = game.advance();
            isGameOver = result.isGameOver;
          }

          if (isGameOver) {
            break;
          }
        }

        if (!isGameOver) {
          throw new Error('1000 steps in the simulation were run but we did not reach game over');
        }

        // Record which ending was reached
        const { beat } = game.position;
        endingsSeen.add(beat);
      }

      // Verify we've seen both endings
      expect(endingsSeen.size).toBe(1);
    });
  });
});
```

## Directions
Reply with a list of actions in the following format. The response should only contain the JSON list of actions, no other text.
Make sure you are using the excerpt_id which contains the entire contents of the file.

Each action in the list must have these fields:
- action: Must be "overwrite"
- excerpt_id: The ID of the excerpt to use
- file_path: The relative path to the file

Example format for multiple files:
[
    {
        "action": "overwrite",
        "excerpt_id": "abc1",
        "file_path": "src/main.py"
    },
    {
        "action": "overwrite",
        "excerpt_id": "def2",
        "file_path": "tests/test_main.py"
    }
]
__________________
Role: assistant
Content: 
__________________
