Role: system
Content: You are a helpful assistant specialized in changing files based on proposed changes.
__________________
Role: user
Content: To fix the issue, we need to modify the `MainGameScene` class in the `main_game_scene.py` file. The problem is that the scene is not exiting properly after the battle ends. We should transition to the `MainMenuScene` after the battle concludes, whether the player wins or loses.

Here's how we'll fix it:

1. In the `check_battle_end` method, we'll return `True` when the battle ends, but we won't immediately exit the scene.
2. In the `game_loop` method, after checking for battle end, we'll transition to the `MainMenuScene` if the battle has ended.
3. We'll remove the `reset_creatures` method call from the `game_loop`, as creature reset should be handled when creating a new battle, not at the end of the current one.

Here's the rewritten `main_game_scene.py` file with these changes:

# Excerpt ID: 51c0c86b-b07e-4c64-8517-88750288d75b
```python main_game/scenes/main_game_scene.py
from mini_game_engine.engine.lib import AbstractGameScene, Button, SelectThing
from main_game.models import Player, Creature, Skill

class MainGameScene(AbstractGameScene):
    def __init__(self, app, player):
        super().__init__(app, player)
        self.foe = app.create_bot("default_player")
        self.player_creature = self.player.creatures[0]
        self.foe_creature = self.foe.creatures[0]

    def __str__(self):
        return f"""===Battle===
{self.player.display_name}'s {self.player_creature.display_name}: HP {self.player_creature.hp}/{self.player_creature.max_hp}
{self.foe.display_name}'s {self.foe_creature.display_name}: HP {self.foe_creature.hp}/{self.foe_creature.max_hp}

Your skills:
{self._format_skills(self.player_creature.skills)}

> Use Skill
> Quit
"""

    def _format_skills(self, skills):
        return "\n".join([f"- {skill.display_name}: {skill.damage} damage" for skill in skills])

    def run(self):
        self.game_loop()

    def game_loop(self):
        while True:
            # Player Choice Phase
            player_skill = self.player_choice_phase()
            
            # Foe Choice Phase
            foe_skill = self.foe_choice_phase()
            
            # Resolution Phase
            self.resolution_phase(player_skill, foe_skill)
            
            # Check for battle end
            if self.check_battle_end():
                self._transition_to_scene("MainMenuScene")
                break

    def player_choice_phase(self):
        use_skill_button = Button("Use Skill")
        quit_button = Button("Quit")
        choices = [use_skill_button, quit_button]
        choice = self._wait_for_choice(self.player, choices)

        if quit_button == choice:
            self._quit_whole_game()

        skill_choices = [SelectThing(skill) for skill in self.player_creature.skills]
        skill_choice = self._wait_for_choice(self.player, skill_choices)
        return skill_choice.thing

    def foe_choice_phase(self):
        skill_choices = [SelectThing(skill) for skill in self.foe_creature.skills]
        skill_choice = self._wait_for_choice(self.foe, skill_choices)
        return skill_choice.thing

    def resolution_phase(self, player_skill, foe_skill):
        self._show_text(self.player, f"You used {player_skill.display_name}!")
        self.foe_creature.hp -= player_skill.damage
        self._show_text(self.player, f"Foe's {self.foe_creature.display_name} took {player_skill.damage} damage!")

        if self.foe_creature.hp > 0:
            self._show_text(self.player, f"Foe used {foe_skill.display_name}!")
            self.player_creature.hp -= foe_skill.damage
            self._show_text(self.player, f"Your {self.player_creature.display_name} took {foe_skill.damage} damage!")

    def check_battle_end(self):
        if self.foe_creature.hp <= 0:
            self._show_text(self.player, "You won the battle!")
            return True
        elif self.player_creature.hp <= 0:
            self._show_text(self.player, "You lost the battle!")
            return True
        return False
```

This modification ensures that the scene transitions back to the main menu after the battle ends, which should resolve the issue of the scene not exiting in an expected manner. The test should now pass as either `_transition_to_scene` or `_quit_whole_game` will be called.
__________________
Role: assistant
Content: ```json
{
  "actions": [
    {
      "action": "overwrite",
      "excerpt_id": "51c0c86b-b07e-4c64-8517-88750288d75b",
      "file_path": "main_game/scenes/main_game_scene.py"
    }
  ]
}
```
__________________
