Role: system
Content: You are a helpful assistant specialized in changing files based on proposed changes.
__________________
Role: user
Content: ## Proposed Code Change
To fix the issue, we need to modify the MainGameScene to properly exit the scene when the battle ends. Currently, the scene is not transitioning or quitting when the battle is over, which causes the test to fail. Here's how we'll fix it:

1. In the MainGameScene, we'll modify the run method to transition back to the MainMenuScene when the battle ends.
2. We'll also add a check for the quit button in the main game loop to allow the player to exit the battle at any time.

Here's the rewritten MainGameScene with the proposed solution:

# Excerpt ID: 2779d08e-8c50-4fae-8da2-bbbc706b1542
```python main_game/scenes/main_game_scene.py
from mini_game_engine.engine.lib import AbstractGameScene, Button
from main_game.models import Player, Creature, Skill

class MainGameScene(AbstractGameScene):
    def __init__(self, app, player):
        super().__init__(app, player)
        self.bot = self._app.create_bot("default_player")
        self.player_creature = self.player.creatures[0]
        self.bot_creature = self.bot.creatures[0]

    def __str__(self):
        return f"""===Battle===
{self.player.display_name}'s {self.player_creature.display_name}: HP {self.player_creature.hp}/{self.player_creature.max_hp}
{self.bot.display_name}'s {self.bot_creature.display_name}: HP {self.bot_creature.hp}/{self.bot_creature.max_hp}

Your skills:
{self._format_skills(self.player_creature.skills)}

> Use skill
> Quit
"""

    def _format_skills(self, skills):
        return "\n".join([f"- {skill.display_name}" for skill in skills])

    def run(self):
        while True:
            use_skill_button = Button("Use skill")
            quit_button = Button("Quit")
            choices = [use_skill_button, quit_button]
            choice = self._wait_for_choice(self.player, choices)

            if use_skill_button == choice:
                self._battle_turn()
                if self._check_battle_end():
                    self._reset_creatures()
                    self._transition_to_scene("MainMenuScene")
                    break
            elif quit_button == choice:
                self._reset_creatures()
                self._transition_to_scene("MainMenuScene")
                break

    def _battle_turn(self):
        player_skill = self._choose_skill(self.player, self.player_creature)
        bot_skill = self._choose_skill(self.bot, self.bot_creature)

        self._resolve_skills(player_skill, bot_skill)

    def _choose_skill(self, player: Player, creature: Creature) -> Skill:
        skill_choices = [Button(skill.display_name) for skill in creature.skills]
        choice = self._wait_for_choice(player, skill_choices)
        return next(skill for skill in creature.skills if skill.display_name == choice.display_name)

    def _resolve_skills(self, player_skill: Skill, bot_skill: Skill):
        self.bot_creature.hp -= player_skill.damage
        self._show_text(self.player, f"Your {self.player_creature.display_name} used {player_skill.display_name}!")
        self._show_text(self.bot, f"Your {self.bot_creature.display_name} took {player_skill.damage} damage!")

        self.player_creature.hp -= bot_skill.damage
        self._show_text(self.player, f"Opponent's {self.bot_creature.display_name} used {bot_skill.display_name}!")
        self._show_text(self.player, f"Your {self.player_creature.display_name} took {bot_skill.damage} damage!")

    def _check_battle_end(self) -> bool:
        if self.player_creature.hp <= 0:
            self._show_text(self.player, "You lost the battle!")
            return True
        elif self.bot_creature.hp <= 0:
            self._show_text(self.player, "You won the battle!")
            return True
        return False

    def _reset_creatures(self):
        self.player_creature.hp = self.player_creature.max_hp
        self.bot_creature.hp = self.bot_creature.max_hp
```

This solution addresses the issue by:

1. Adding a check for battle end after each turn in the main game loop.
2. Transitioning back to the MainMenuScene when the battle ends or when the player chooses to quit.
3. Resetting the creatures' HP before transitioning to ensure the game state is clean for the next battle.

These changes should make the MainGameScene exit properly, either by completing the battle or by the player choosing to quit. This should resolve the test failure and make the scene behave as expected within the game's architecture and the engine's capabilities.

## Directions
Reply with a list of actions in the following format. The response should only contain the JSON list of actions, no other text.
Make sure you are using the excerpt_id which contains the entire contents of the file.

Each action in the list must have these fields:
- action: Must be "overwrite"
- excerpt_id: The ID of the excerpt to use
- file_path: The relative path to the file

Example format for multiple files:
[
    {
        "action": "overwrite",
        "excerpt_id": "abc1",
        "file_path": "src/main.py"
    },
    {
        "action": "overwrite",
        "excerpt_id": "def2",
        "file_path": "tests/test_main.py"
    }
]
__________________
Role: assistant
Content: 
__________________
