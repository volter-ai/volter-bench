timestamp,run_id,agent_id,ladder,run,status,error,traceback,logs,project_directory,commit_url,branch_name,project_type,override_model,strong_completion_model,base_chat_completion_model,fast_chat_completion_model,strong_coding_completion_model
2024-11-22 14:19:01,eb1ba8cc-90b0-4f1c-8860-4f74c38537f6,OneShotCoreAgent,creature_battler_01,5,success,,,['new_prompt_logs/999997_781452_OneShotCoreAgent'],ladder/creature_battler_01_5/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:19:12,1e000b04-c3cf-4135-a8c8-39590b1081e2,OneShotCoreAgent,creature_battler_01,6,success,,,['new_prompt_logs/999998_515099_OneShotCoreAgent'],ladder/creature_battler_01_6/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:19:28,59d686ff-29ce-4c40-bf73-7b737ef2f0ee,OneShotCoreAgent,creature_battler_01,3,success,,,['new_prompt_logs/999994_501875_OneShotCoreAgent'],ladder/creature_battler_01_3/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:19:54,fbb5f124-c535-4227-9df2-1c7c8bc9c603,OneShotCoreAgent,creature_battler_01,1,success,,,['new_prompt_logs/999996_958882_OneShotCoreAgent'],ladder/creature_battler_01_1/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:19:56,b82b5645-2ab5-4d00-8074-a17b009887c1,OneShotCoreAgent,creature_battler_01,2,success,,,['new_prompt_logs/999995_229642_OneShotCoreAgent'],ladder/creature_battler_01_2/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:20:45,db8732bd-51aa-4d27-b917-f35467dfa2e8,OneShotCoreAgent,creature_battler_01,4,success,,,['new_prompt_logs/999999_130884_OneShotCoreAgent'],ladder/creature_battler_01_4/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:20:51,4302c106-6118-4287-b75e-1c9d1c0e0c70,OneShotCoreAgent,creature_battler_02,1,success,,,['new_prompt_logs/999998_515099_OneShotCoreAgent'],ladder/creature_battler_02_1/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:20:54,0c2396f0-8d11-421a-b830-d50a13c5c325,OneShotCoreAgent,creature_battler_01,7,success,,,['new_prompt_logs/999997_781452_OneShotCoreAgent'],ladder/creature_battler_01_7/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:21:20,25d5d610-e3da-41b0-9956-f1bfd1223223,OneShotCoreAgent,creature_battler_02,2,success,,,['new_prompt_logs/999994_501875_OneShotCoreAgent'],ladder/creature_battler_02_2/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:21:31,d0700842-ff84-4728-b5fd-3a9c01455ddb,OneShotCoreAgent,creature_battler_02,4,success,,,['new_prompt_logs/999995_229642_OneShotCoreAgent'],ladder/creature_battler_02_4/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:21:43,7c5ca295-0042-4083-a107-ada76bf1fbd6,OneShotCoreAgent,creature_battler_02,3,success,,,['new_prompt_logs/999996_958882_OneShotCoreAgent'],ladder/creature_battler_02_3/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:22:15,d09c255a-c24d-429f-934d-46660d9b0f43,OneShotCoreAgent,creature_battler_02,5,success,,,['new_prompt_logs/999999_130884_OneShotCoreAgent'],ladder/creature_battler_02_5/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:22:43,79b6c58c-1f22-44a1-94a3-eca6b4369826,OneShotCoreAgent,creature_battler_02,6,success,,,['new_prompt_logs/999998_515099_OneShotCoreAgent'],ladder/creature_battler_02_6/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:22:50,c9bc4688-9bc7-427f-8b91-2b4c0b1b717b,OneShotCoreAgent,creature_battler_02,7,success,,,['new_prompt_logs/999997_781452_OneShotCoreAgent'],ladder/creature_battler_02_7/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:23:37,74150a14-8035-4152-a0f3-3a05d5af32df,OneShotCoreAgent,creature_battler_03,1,success,,,['new_prompt_logs/999994_501875_OneShotCoreAgent'],ladder/creature_battler_03_1/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:24:10,0387dda4-32fb-4e25-b545-27eddcc41063,OneShotCoreAgent,creature_battler_03,2,success,,,['new_prompt_logs/999995_229642_OneShotCoreAgent'],ladder/creature_battler_03_2/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:24:10,51e5b902-0cbe-42b4-8ee6-0279f050c679,OneShotCoreAgent,creature_battler_03,3,success,,,['new_prompt_logs/999996_958882_OneShotCoreAgent'],ladder/creature_battler_03_3/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:24:24,00569e94-fd76-4afc-8068-41fd951bd20c,OneShotCoreAgent,creature_battler_03,4,success,,,['new_prompt_logs/999999_130884_OneShotCoreAgent'],ladder/creature_battler_03_4/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:24:47,7fb2f2eb-6915-4eb6-8ddf-a2f87c7614e1,OneShotCoreAgent,creature_battler_03,5,success,,,['new_prompt_logs/999998_515099_OneShotCoreAgent'],ladder/creature_battler_03_5/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:25:30,2b6a6884-9e66-409b-97ac-ef7c92d51f13,OneShotCoreAgent,creature_battler_03,6,success,,,['new_prompt_logs/999997_781452_OneShotCoreAgent'],ladder/creature_battler_03_6/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:25:44,95a23aee-510c-4045-a672-3c9b3344d162,OneShotCoreAgent,creature_battler_03,7,success,,,['new_prompt_logs/999994_501875_OneShotCoreAgent'],ladder/creature_battler_03_7/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:26:24,f2ad2157-69e0-486f-93b0-de94b1f8e927,OneShotCoreAgent,creature_battler_04,1,success,,,['new_prompt_logs/999995_229642_OneShotCoreAgent'],ladder/creature_battler_04_1/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:26:26,124cc1ff-1c5d-4bc1-87af-5b3ee6a7c28e,OneShotCoreAgent,creature_battler_04,2,success,,,['new_prompt_logs/999996_958882_OneShotCoreAgent'],ladder/creature_battler_04_2/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:26:53,040a9d22-a2b9-4d55-acd7-f8786bb926e5,OneShotCoreAgent,creature_battler_04,3,success,,,['new_prompt_logs/999999_130884_OneShotCoreAgent'],ladder/creature_battler_04_3/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:27:25,e6f7b395-e3ce-40b9-81ef-c41ac0b6e960,OneShotCoreAgent,creature_battler_04,4,success,,,['new_prompt_logs/999998_515099_OneShotCoreAgent'],ladder/creature_battler_04_4/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:28:11,a73c0ede-44b8-46f3-9653-87c0a5ee18b8,OneShotCoreAgent,creature_battler_04,6,success,,,['new_prompt_logs/999994_501875_OneShotCoreAgent'],ladder/creature_battler_04_6/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:28:38,2e16cf5d-531c-4a87-8906-32da0ff108ed,OneShotCoreAgent,creature_battler_04,7,success,,,['new_prompt_logs/999995_229642_OneShotCoreAgent'],ladder/creature_battler_04_7/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:28:39,c82acbc1-b74a-497b-b3a4-d923db052ee7,OneShotCoreAgent,creature_battler_04,5,success,,,['new_prompt_logs/999997_781452_OneShotCoreAgent'],ladder/creature_battler_04_5/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:28:52,20b59655-968a-443a-8879-d6af9ae4b7f5,OneShotCoreAgent,creature_battler_05,2,success,,,['new_prompt_logs/999999_130884_OneShotCoreAgent'],ladder/creature_battler_05_2/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:30:20,c2fe68f8-ccd4-4cde-bc3f-73e3779985e0,OneShotCoreAgent,creature_battler_05,3,failure,"After 5 attempts to debug, could not create a bug-free game. Still have error Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py .                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            try:
>               scene.run()

main_game/tests/test_main_game_scene.py:22: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
main_game/scenes/main_game_scene.py:40: in run
    self._quit_whole_game()  # Properly end the game when battle is over
../../../../mge2/mini_game_engine/engine/lib.py:459: in _quit_whole_game
    self._app.quit_whole_game()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>

    def quit_whole_game(self):
        self.terminated = True
>       raise AbstractApp._QuitWholeGame()
E       mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught

../../../../mge2/mini_game_engine/engine/lib.py:625: _QuitWholeGame
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
Bubwool used Tackle! Dealt 5 damage to Scizard!
Scizard used Tackle! Dealt 8 damage to Bubwool!
Bubwool used Tackle! Dealt 5 damage to Scizard!
Scizard used Tackle! Dealt 8 damage to Bubwool!
You switched to Dumbird!
Scizard used Tackle! Dealt 9 damage to Dumbird!
Dumbird used Tackle! Dealt 1 damage to Scizard!
Scizard used Fireball! Dealt 13 damage to Dumbird!
You switched to Bubwool!
Scizard used Tackle! Dealt 8 damage to Bubwool!
No other creatures available!
No other creatures available!
No other creatures available!
Foe switched to Dumbird!
Bubwool used Tackle! Dealt 9 damage to Dumbird!
Dumbird used Tackle! Dealt 4 damage to Bubwool!
Bubwool used Tackle! Dealt 9 damage to Dumbird!
No other creatures available!
No other creatures available!
No other creatures available!
Dumbird used Tackle! Dealt 4 damage to Bubwool!
You lost the battle!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught
========================= 1 failed, 2 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1
","Traceback (most recent call last):
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py"", line 72, in execute
    await self.sdk.execute_as_task(PytestRunnerAgent, verbose=False)
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/volter-common/common/sdk/SDK.py"", line 254, in execute_as_task
    response = await agent.execute()
               ^^^^^^^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/game/pytest_runner_agent/logic.py"", line 30, in execute
    output = run_pytest(test_file_path, project_root=self.sdk.project_directory, verbose=self.verbose)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-std-agents/agent_lib/random_run_utils.py"", line 141, in run_pytest
    raise AssertionError(f""Pytest failed with exit code {exit_code}. Output:\n{output}"")
AssertionError: Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py .                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            try:
>               scene.run()

main_game/tests/test_main_game_scene.py:22: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
main_game/scenes/main_game_scene.py:40: in run
    self._quit_whole_game()  # Properly end the game when battle is over
../../../../mge2/mini_game_engine/engine/lib.py:459: in _quit_whole_game
    self._app.quit_whole_game()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>

    def quit_whole_game(self):
        self.terminated = True
>       raise AbstractApp._QuitWholeGame()
E       mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught

../../../../mge2/mini_game_engine/engine/lib.py:625: _QuitWholeGame
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
Bubwool used Tackle! Dealt 5 damage to Scizard!
Scizard used Tackle! Dealt 8 damage to Bubwool!
Bubwool used Tackle! Dealt 5 damage to Scizard!
Scizard used Tackle! Dealt 8 damage to Bubwool!
You switched to Dumbird!
Scizard used Tackle! Dealt 9 damage to Dumbird!
Dumbird used Tackle! Dealt 1 damage to Scizard!
Scizard used Fireball! Dealt 13 damage to Dumbird!
You switched to Bubwool!
Scizard used Tackle! Dealt 8 damage to Bubwool!
No other creatures available!
No other creatures available!
No other creatures available!
Foe switched to Dumbird!
Bubwool used Tackle! Dealt 9 damage to Dumbird!
Dumbird used Tackle! Dealt 4 damage to Bubwool!
Bubwool used Tackle! Dealt 9 damage to Dumbird!
No other creatures available!
No other creatures available!
No other creatures available!
Dumbird used Tackle! Dealt 4 damage to Bubwool!
You lost the battle!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught
========================= 1 failed, 2 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_bench/bench_utils.py"", line 93, in execute_agent
    asyncio.run(agent.execute())
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/runners.py"", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/runners.py"", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/base_events.py"", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py"", line 79, in execute
    raise FixableException(
common.exceptions.FixableException: After 5 attempts to debug, could not create a bug-free game. Still have error Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py .                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            try:
>               scene.run()

main_game/tests/test_main_game_scene.py:22: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
main_game/scenes/main_game_scene.py:40: in run
    self._quit_whole_game()  # Properly end the game when battle is over
../../../../mge2/mini_game_engine/engine/lib.py:459: in _quit_whole_game
    self._app.quit_whole_game()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>

    def quit_whole_game(self):
        self.terminated = True
>       raise AbstractApp._QuitWholeGame()
E       mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught

../../../../mge2/mini_game_engine/engine/lib.py:625: _QuitWholeGame
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
Bubwool used Tackle! Dealt 5 damage to Scizard!
Scizard used Tackle! Dealt 8 damage to Bubwool!
Bubwool used Tackle! Dealt 5 damage to Scizard!
Scizard used Tackle! Dealt 8 damage to Bubwool!
You switched to Dumbird!
Scizard used Tackle! Dealt 9 damage to Dumbird!
Dumbird used Tackle! Dealt 1 damage to Scizard!
Scizard used Fireball! Dealt 13 damage to Dumbird!
You switched to Bubwool!
Scizard used Tackle! Dealt 8 damage to Bubwool!
No other creatures available!
No other creatures available!
No other creatures available!
Foe switched to Dumbird!
Bubwool used Tackle! Dealt 9 damage to Dumbird!
Dumbird used Tackle! Dealt 4 damage to Bubwool!
Bubwool used Tackle! Dealt 9 damage to Dumbird!
No other creatures available!
No other creatures available!
No other creatures available!
Dumbird used Tackle! Dealt 4 damage to Bubwool!
You lost the battle!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught
========================= 1 failed, 2 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1

",['new_prompt_logs/999998_515099_OneShotCoreAgent'],ladder/creature_battler_05_3/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:31:12,46b24115-859b-4421-abb4-1fae2a02e97b,OneShotCoreAgent,creature_battler_05,1,success,,,['new_prompt_logs/999996_958882_OneShotCoreAgent'],ladder/creature_battler_05_1/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:31:22,66d4b502-9b1b-44db-bbad-e316af4415be,OneShotCoreAgent,creature_battler_05,4,failure,"After 5 attempts to debug, could not create a bug-free game. Still have error Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py F                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""Starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30  # More moves needed for battle scene
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            class TransitionFromScene(Exception):
                pass
    
            def exit_scene(*args, **kwargs):
                raise TransitionFromScene()
    
            with patch.object(MainGameScene, '_transition_to_scene', side_effect=exit_scene) as mock_transition, \
                 patch.object(MainGameScene, '_quit_whole_game') as mock_quit:
    
                try:
                    scene.run()
                except TransitionFromScene:
                    print(f""Exiting MainGameScene, ending run {i}"")
                except RandomModeGracefulExit:
                    print(f""Random mode counter reached 0, ending run {i}"")
                else:
>                   assert mock_transition.called or mock_quit.called
E                   AssertionError: assert (False or False)
E                    +  where False = <MagicMock name='_transition_to_scene' id='[REDACTED]'>.called
E                    +  and   False = <MagicMock name='_quit_whole_game' id='[REDACTED]'>.called

main_game/tests/test_main_game_scene.py:37: AssertionError
----------------------------- Captured stdout call -----------------------------
Starting random run iteration 0
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You used Tackle! Dealt 1 damage!
Foe used Fireball! Dealt 13 damage!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Random mode counter reached 0, ending run 0
Starting random run iteration 1
Foe switched to Dumbird!
Foe used Lick! Dealt 2 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You switched to Bubwool!
Foe used Fireball! Dealt 2 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
Random mode counter reached 0, ending run 1
Starting random run iteration 2
You switched to Dumbird!
Foe switched to Dumbird!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe switched to Scizard!
Foe used Tackle! Dealt 8 damage!
Random mode counter reached 0, ending run 2
Starting random run iteration 3
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe switched to Scizard!
You switched to Bubwool!
Foe switched to Dumbird!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
Foe switched to Scizard!
Foe used Tackle! Dealt 8 damage!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
Random mode counter reached 0, ending run 3
Starting random run iteration 4
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You used Tackle! Dealt 1 damage!
Foe used Fireball! Dealt 13 damage!
No other creatures available!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
Random mode counter reached 0, ending run 4
Starting random run iteration 5
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You used Tackle! Dealt 1 damage!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Random mode counter reached 0, ending run 5
Starting random run iteration 6
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe switched to Dumbird!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe switched to Scizard!
You switched to Bubwool!
Foe switched to Dumbird!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 5 damage!
Random mode counter reached 0, ending run 6
Starting random run iteration 7
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You used Tackle! Dealt 1 damage!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You lose!
_____________________ test_full_game_flow_random_with_bots _____________________

    def test_full_game_flow_random_with_bots():
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 100  # 100 moves suffice for running through some common scenarios in the game
            App.matchmaking_wait_time = 0
            original_wait_time = App.matchmaking_wait_time
    
            app = App()
    
            # Create a human player
            human_player = app.create_player(""HumanPlayer"")
            human_player.set_listener(HumanListener())
    
            try:
>               app.run(human_player)

main_game/tests/test_whole_game.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../mge2/mini_game_engine/engine/lib.py:629: in run
    self.transition_to_scene(self.entry_point_scene_id, player=player)
../../../../mge2/mini_game_engine/engine/lib.py:745: in transition_to_scene
    self.__run_scene(scene)
../../../../mge2/mini_game_engine/engine/lib.py:789: in __run_scene
    scene.run()
main_game/scenes/main_menu_scene.py:22: in run
    self._transition_to_scene(""MainGameScene"")
../../../../mge2/mini_game_engine/engine/lib.py:462: in _transition_to_scene
    self._app.transition_to_scene(scene_name, player=self.player)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>, scene_id = 'MainGameScene'
transition_to_scene = None, kwargs = {'player': Default Player}
settings = Settings(env='LOCAL', redis_host='localhost', redis_port=6379, redis_secure_auth='', enable_persistence=False, enable_... enable_leaderboard_persistence=False, supabase_url='', supabase_key='', supabase_jwt_secret='', game_id='volter-game')

        def transition_to_scene(self, scene_id: str, transition_to_scene: Optional[AbstractGameScene] = None, **kwargs):
            try:
                settings = get_settings()
                if settings.enable_persistence:
                    saved_data = self.persistence_client.retrieve(kwargs.get('player'))
                    if saved_data:
                        print(""---> Fetching data"", saved_data)
                        dehydrated_scene_stack, next_scene_name = saved_data
                        if next_scene_name:
                            new_scene_stack = []
                            for dehydrated_scene in dehydrated_scene_stack:
                                scene_kwargs = {**dehydrated_scene}
                                del scene_kwargs[""__type""]
                                new_scene = self.scene_registry.get(dehydrated_scene[""__type""]).model_validate({
                                    **scene_kwargs,
                                    **kwargs
                                })
                                new_scene_stack.append(new_scene)
                            self._scene_stack = new_scene_stack
                            for _scene in self._scene_stack:
                                _scene.player = kwargs.get('player')
                            scene_id = next_scene_name
    
                scene_factory = self.scene_registry[scene_id]
            except KeyError as e:
                raise Exception(f""The scene {scene_id} is not registered, ""
                                f""all scenes should be registered using `register_scene` before `app.run()`"") from e
    
            if issubclass(scene_factory, AbstractMultiplayerScene):
                if kwargs.get(""player"") is not None:
                    raise Exception(""player argument cannot be used on a multiplayer scene, you must use 'players'"")
                if kwargs.get(""players"") is None:
                    raise Exception(""players argument must be set on a multiplayer scene"")
            scene = transition_to_scene
    
            if not scene:
                scene: AbstractGameScene = scene_factory(app=self, **kwargs)
    
            self.__run_scene(scene)
    
            # Technically the code can never reach this
>           raise FixableException(f""""""
    Scene ({scene.__class__.__name__}) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This
    probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.
    Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling
    `quit_whole_game` to signal that the game has ended.
    """""")
E   common.exceptions.FixableException: 
E   Scene (MainGameScene) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This 
E   probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.  
E   Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling 
E   `quit_whole_game` to signal that the game has ended.

../../../../mge2/mini_game_engine/engine/lib.py:748: FixableException
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
broadcast: {'__type': 'OnGameStart'}
broadcast: {'__type': 'OnGameEnd'}
game exited gracefully
starting random run iteration 1
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You lose!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - AssertionError: assert (False or False)
 +  where False = <MagicMock name='_transition_to_scene' id='[REDACTED]'>.called
 +  and   False = <MagicMock name='_quit_whole_game' id='[REDACTED]'>.called
FAILED main_game/tests/test_whole_game.py::test_full_game_flow_random_with_bots - common.exceptions.FixableException: 
Scene (MainGameScene) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This 
probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.  
Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling 
`quit_whole_game` to signal that the game has ended.
========================= 2 failed, 1 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1
","Traceback (most recent call last):
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py"", line 72, in execute
    await self.sdk.execute_as_task(PytestRunnerAgent, verbose=False)
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/volter-common/common/sdk/SDK.py"", line 254, in execute_as_task
    response = await agent.execute()
               ^^^^^^^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/game/pytest_runner_agent/logic.py"", line 30, in execute
    output = run_pytest(test_file_path, project_root=self.sdk.project_directory, verbose=self.verbose)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-std-agents/agent_lib/random_run_utils.py"", line 141, in run_pytest
    raise AssertionError(f""Pytest failed with exit code {exit_code}. Output:\n{output}"")
AssertionError: Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py F                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""Starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30  # More moves needed for battle scene
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            class TransitionFromScene(Exception):
                pass
    
            def exit_scene(*args, **kwargs):
                raise TransitionFromScene()
    
            with patch.object(MainGameScene, '_transition_to_scene', side_effect=exit_scene) as mock_transition, \
                 patch.object(MainGameScene, '_quit_whole_game') as mock_quit:
    
                try:
                    scene.run()
                except TransitionFromScene:
                    print(f""Exiting MainGameScene, ending run {i}"")
                except RandomModeGracefulExit:
                    print(f""Random mode counter reached 0, ending run {i}"")
                else:
>                   assert mock_transition.called or mock_quit.called
E                   AssertionError: assert (False or False)
E                    +  where False = <MagicMock name='_transition_to_scene' id='[REDACTED]'>.called
E                    +  and   False = <MagicMock name='_quit_whole_game' id='[REDACTED]'>.called

main_game/tests/test_main_game_scene.py:37: AssertionError
----------------------------- Captured stdout call -----------------------------
Starting random run iteration 0
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You used Tackle! Dealt 1 damage!
Foe used Fireball! Dealt 13 damage!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Random mode counter reached 0, ending run 0
Starting random run iteration 1
Foe switched to Dumbird!
Foe used Lick! Dealt 2 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You switched to Bubwool!
Foe used Fireball! Dealt 2 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
Random mode counter reached 0, ending run 1
Starting random run iteration 2
You switched to Dumbird!
Foe switched to Dumbird!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe switched to Scizard!
Foe used Tackle! Dealt 8 damage!
Random mode counter reached 0, ending run 2
Starting random run iteration 3
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe switched to Scizard!
You switched to Bubwool!
Foe switched to Dumbird!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
Foe switched to Scizard!
Foe used Tackle! Dealt 8 damage!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
Random mode counter reached 0, ending run 3
Starting random run iteration 4
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You used Tackle! Dealt 1 damage!
Foe used Fireball! Dealt 13 damage!
No other creatures available!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
Random mode counter reached 0, ending run 4
Starting random run iteration 5
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You used Tackle! Dealt 1 damage!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Random mode counter reached 0, ending run 5
Starting random run iteration 6
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe switched to Dumbird!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe switched to Scizard!
You switched to Bubwool!
Foe switched to Dumbird!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 5 damage!
Random mode counter reached 0, ending run 6
Starting random run iteration 7
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You used Tackle! Dealt 1 damage!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You lose!
_____________________ test_full_game_flow_random_with_bots _____________________

    def test_full_game_flow_random_with_bots():
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 100  # 100 moves suffice for running through some common scenarios in the game
            App.matchmaking_wait_time = 0
            original_wait_time = App.matchmaking_wait_time
    
            app = App()
    
            # Create a human player
            human_player = app.create_player(""HumanPlayer"")
            human_player.set_listener(HumanListener())
    
            try:
>               app.run(human_player)

main_game/tests/test_whole_game.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../mge2/mini_game_engine/engine/lib.py:629: in run
    self.transition_to_scene(self.entry_point_scene_id, player=player)
../../../../mge2/mini_game_engine/engine/lib.py:745: in transition_to_scene
    self.__run_scene(scene)
../../../../mge2/mini_game_engine/engine/lib.py:789: in __run_scene
    scene.run()
main_game/scenes/main_menu_scene.py:22: in run
    self._transition_to_scene(""MainGameScene"")
../../../../mge2/mini_game_engine/engine/lib.py:462: in _transition_to_scene
    self._app.transition_to_scene(scene_name, player=self.player)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>, scene_id = 'MainGameScene'
transition_to_scene = None, kwargs = {'player': Default Player}
settings = Settings(env='LOCAL', redis_host='localhost', redis_port=6379, redis_secure_auth='', enable_persistence=False, enable_... enable_leaderboard_persistence=False, supabase_url='', supabase_key='', supabase_jwt_secret='', game_id='volter-game')

        def transition_to_scene(self, scene_id: str, transition_to_scene: Optional[AbstractGameScene] = None, **kwargs):
            try:
                settings = get_settings()
                if settings.enable_persistence:
                    saved_data = self.persistence_client.retrieve(kwargs.get('player'))
                    if saved_data:
                        print(""---> Fetching data"", saved_data)
                        dehydrated_scene_stack, next_scene_name = saved_data
                        if next_scene_name:
                            new_scene_stack = []
                            for dehydrated_scene in dehydrated_scene_stack:
                                scene_kwargs = {**dehydrated_scene}
                                del scene_kwargs[""__type""]
                                new_scene = self.scene_registry.get(dehydrated_scene[""__type""]).model_validate({
                                    **scene_kwargs,
                                    **kwargs
                                })
                                new_scene_stack.append(new_scene)
                            self._scene_stack = new_scene_stack
                            for _scene in self._scene_stack:
                                _scene.player = kwargs.get('player')
                            scene_id = next_scene_name
    
                scene_factory = self.scene_registry[scene_id]
            except KeyError as e:
                raise Exception(f""The scene {scene_id} is not registered, ""
                                f""all scenes should be registered using `register_scene` before `app.run()`"") from e
    
            if issubclass(scene_factory, AbstractMultiplayerScene):
                if kwargs.get(""player"") is not None:
                    raise Exception(""player argument cannot be used on a multiplayer scene, you must use 'players'"")
                if kwargs.get(""players"") is None:
                    raise Exception(""players argument must be set on a multiplayer scene"")
            scene = transition_to_scene
    
            if not scene:
                scene: AbstractGameScene = scene_factory(app=self, **kwargs)
    
            self.__run_scene(scene)
    
            # Technically the code can never reach this
>           raise FixableException(f""""""
    Scene ({scene.__class__.__name__}) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This
    probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.
    Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling
    `quit_whole_game` to signal that the game has ended.
    """""")
E   common.exceptions.FixableException: 
E   Scene (MainGameScene) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This 
E   probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.  
E   Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling 
E   `quit_whole_game` to signal that the game has ended.

../../../../mge2/mini_game_engine/engine/lib.py:748: FixableException
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
broadcast: {'__type': 'OnGameStart'}
broadcast: {'__type': 'OnGameEnd'}
game exited gracefully
starting random run iteration 1
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You lose!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - AssertionError: assert (False or False)
 +  where False = <MagicMock name='_transition_to_scene' id='[REDACTED]'>.called
 +  and   False = <MagicMock name='_quit_whole_game' id='[REDACTED]'>.called
FAILED main_game/tests/test_whole_game.py::test_full_game_flow_random_with_bots - common.exceptions.FixableException: 
Scene (MainGameScene) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This 
probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.  
Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling 
`quit_whole_game` to signal that the game has ended.
========================= 2 failed, 1 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_bench/bench_utils.py"", line 93, in execute_agent
    asyncio.run(agent.execute())
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/runners.py"", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/runners.py"", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/base_events.py"", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py"", line 79, in execute
    raise FixableException(
common.exceptions.FixableException: After 5 attempts to debug, could not create a bug-free game. Still have error Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py F                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""Starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30  # More moves needed for battle scene
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            class TransitionFromScene(Exception):
                pass
    
            def exit_scene(*args, **kwargs):
                raise TransitionFromScene()
    
            with patch.object(MainGameScene, '_transition_to_scene', side_effect=exit_scene) as mock_transition, \
                 patch.object(MainGameScene, '_quit_whole_game') as mock_quit:
    
                try:
                    scene.run()
                except TransitionFromScene:
                    print(f""Exiting MainGameScene, ending run {i}"")
                except RandomModeGracefulExit:
                    print(f""Random mode counter reached 0, ending run {i}"")
                else:
>                   assert mock_transition.called or mock_quit.called
E                   AssertionError: assert (False or False)
E                    +  where False = <MagicMock name='_transition_to_scene' id='[REDACTED]'>.called
E                    +  and   False = <MagicMock name='_quit_whole_game' id='[REDACTED]'>.called

main_game/tests/test_main_game_scene.py:37: AssertionError
----------------------------- Captured stdout call -----------------------------
Starting random run iteration 0
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You used Tackle! Dealt 1 damage!
Foe used Fireball! Dealt 13 damage!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Random mode counter reached 0, ending run 0
Starting random run iteration 1
Foe switched to Dumbird!
Foe used Lick! Dealt 2 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You switched to Bubwool!
Foe used Fireball! Dealt 2 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
Random mode counter reached 0, ending run 1
Starting random run iteration 2
You switched to Dumbird!
Foe switched to Dumbird!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe switched to Scizard!
Foe used Tackle! Dealt 8 damage!
Random mode counter reached 0, ending run 2
Starting random run iteration 3
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe switched to Scizard!
You switched to Bubwool!
Foe switched to Dumbird!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
Foe switched to Scizard!
Foe used Tackle! Dealt 8 damage!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
Random mode counter reached 0, ending run 3
Starting random run iteration 4
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You used Tackle! Dealt 1 damage!
Foe used Fireball! Dealt 13 damage!
No other creatures available!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
Random mode counter reached 0, ending run 4
Starting random run iteration 5
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
You used Tackle! Dealt 1 damage!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Random mode counter reached 0, ending run 5
Starting random run iteration 6
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe switched to Dumbird!
You switched to Bubwool!
Foe used Tackle! Dealt 4 damage!
You switched to Dumbird!
Foe switched to Scizard!
You switched to Bubwool!
Foe switched to Dumbird!
You switched to Dumbird!
Foe used Tackle! Dealt 5 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 5 damage!
Random mode counter reached 0, ending run 6
Starting random run iteration 7
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You used Tackle! Dealt 1 damage!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
Foe switched to Dumbird!
Foe used Tackle! Dealt 4 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Tackle! Dealt 9 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
Foe used Tackle! Dealt 4 damage!
You used Lick! Dealt 7 damage!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You lose!
_____________________ test_full_game_flow_random_with_bots _____________________

    def test_full_game_flow_random_with_bots():
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 100  # 100 moves suffice for running through some common scenarios in the game
            App.matchmaking_wait_time = 0
            original_wait_time = App.matchmaking_wait_time
    
            app = App()
    
            # Create a human player
            human_player = app.create_player(""HumanPlayer"")
            human_player.set_listener(HumanListener())
    
            try:
>               app.run(human_player)

main_game/tests/test_whole_game.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
../../../../mge2/mini_game_engine/engine/lib.py:629: in run
    self.transition_to_scene(self.entry_point_scene_id, player=player)
../../../../mge2/mini_game_engine/engine/lib.py:745: in transition_to_scene
    self.__run_scene(scene)
../../../../mge2/mini_game_engine/engine/lib.py:789: in __run_scene
    scene.run()
main_game/scenes/main_menu_scene.py:22: in run
    self._transition_to_scene(""MainGameScene"")
../../../../mge2/mini_game_engine/engine/lib.py:462: in _transition_to_scene
    self._app.transition_to_scene(scene_name, player=self.player)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>, scene_id = 'MainGameScene'
transition_to_scene = None, kwargs = {'player': Default Player}
settings = Settings(env='LOCAL', redis_host='localhost', redis_port=6379, redis_secure_auth='', enable_persistence=False, enable_... enable_leaderboard_persistence=False, supabase_url='', supabase_key='', supabase_jwt_secret='', game_id='volter-game')

        def transition_to_scene(self, scene_id: str, transition_to_scene: Optional[AbstractGameScene] = None, **kwargs):
            try:
                settings = get_settings()
                if settings.enable_persistence:
                    saved_data = self.persistence_client.retrieve(kwargs.get('player'))
                    if saved_data:
                        print(""---> Fetching data"", saved_data)
                        dehydrated_scene_stack, next_scene_name = saved_data
                        if next_scene_name:
                            new_scene_stack = []
                            for dehydrated_scene in dehydrated_scene_stack:
                                scene_kwargs = {**dehydrated_scene}
                                del scene_kwargs[""__type""]
                                new_scene = self.scene_registry.get(dehydrated_scene[""__type""]).model_validate({
                                    **scene_kwargs,
                                    **kwargs
                                })
                                new_scene_stack.append(new_scene)
                            self._scene_stack = new_scene_stack
                            for _scene in self._scene_stack:
                                _scene.player = kwargs.get('player')
                            scene_id = next_scene_name
    
                scene_factory = self.scene_registry[scene_id]
            except KeyError as e:
                raise Exception(f""The scene {scene_id} is not registered, ""
                                f""all scenes should be registered using `register_scene` before `app.run()`"") from e
    
            if issubclass(scene_factory, AbstractMultiplayerScene):
                if kwargs.get(""player"") is not None:
                    raise Exception(""player argument cannot be used on a multiplayer scene, you must use 'players'"")
                if kwargs.get(""players"") is None:
                    raise Exception(""players argument must be set on a multiplayer scene"")
            scene = transition_to_scene
    
            if not scene:
                scene: AbstractGameScene = scene_factory(app=self, **kwargs)
    
            self.__run_scene(scene)
    
            # Technically the code can never reach this
>           raise FixableException(f""""""
    Scene ({scene.__class__.__name__}) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This
    probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.
    Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling
    `quit_whole_game` to signal that the game has ended.
    """""")
E   common.exceptions.FixableException: 
E   Scene (MainGameScene) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This 
E   probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.  
E   Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling 
E   `quit_whole_game` to signal that the game has ended.

../../../../mge2/mini_game_engine/engine/lib.py:748: FixableException
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
broadcast: {'__type': 'OnGameStart'}
broadcast: {'__type': 'OnGameEnd'}
game exited gracefully
starting random run iteration 1
You switched to Dumbird!
Foe used Fireball! Dealt 13 damage!
You switched to Bubwool!
Foe used Tackle! Dealt 8 damage!
You switched to Dumbird!
Foe used Tackle! Dealt 9 damage!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
You used Tackle! Dealt 5 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Fireball! Dealt 2 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
You used Tackle! Dealt 5 damage!
Foe used Tackle! Dealt 8 damage!
No other creatures available!
You used Lick! Dealt 6 damage!
Foe used Tackle! Dealt 8 damage!
You lose!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - AssertionError: assert (False or False)
 +  where False = <MagicMock name='_transition_to_scene' id='[REDACTED]'>.called
 +  and   False = <MagicMock name='_quit_whole_game' id='[REDACTED]'>.called
FAILED main_game/tests/test_whole_game.py::test_full_game_flow_random_with_bots - common.exceptions.FixableException: 
Scene (MainGameScene) terminated without calling `quit_whole_game` or `transition_to_scene` again.  This 
probably indicates that you have returned directly or broke from the scene's game loop, which is an antipattern.  
Consider transitioning to the appropriate scene, or alternatively if this is the end of the game, calling 
`quit_whole_game` to signal that the game has ended.
========================= 2 failed, 1 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1

",['new_prompt_logs/999994_501875_OneShotCoreAgent'],ladder/creature_battler_05_4/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:31:33,b79b5d54-457d-4db8-82bf-caf6f5ea7eb3,OneShotCoreAgent,creature_battler_05,6,success,,,['new_prompt_logs/999997_781452_OneShotCoreAgent'],ladder/creature_battler_05_6/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:31:42,5cf70ce8-92ee-44e7-bd7b-e42576099513,OneShotCoreAgent,creature_battler_05,5,success,,,['new_prompt_logs/999995_229642_OneShotCoreAgent'],ladder/creature_battler_05_5/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
2024-11-22 14:32:30,9ce83f76-9cd9-466c-bbff-fc45234e7b5c,OneShotCoreAgent,creature_battler_05,7,failure,"After 5 attempts to debug, could not create a bug-free game. Still have error Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py .                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30  # More moves needed for battle
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            try:
>               scene.run()

main_game/tests/test_main_game_scene.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
main_game/scenes/main_game_scene.py:37: in run
    self.check_battle_end()
main_game/scenes/main_game_scene.py:141: in check_battle_end
    self._quit_whole_game()
../../../../mge2/mini_game_engine/engine/lib.py:459: in _quit_whole_game
    self._app.quit_whole_game()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>

    def quit_whole_game(self):
        self.terminated = True
>       raise AbstractApp._QuitWholeGame()
E       mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught

../../../../mge2/mini_game_engine/engine/lib.py:625: _QuitWholeGame
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
`random_mode_counter` reached 0 and the game did not crash. Ending run 0 gracefully
starting random run iteration 1
`random_mode_counter` reached 0 and the game did not crash. Ending run 1 gracefully
starting random run iteration 2
`random_mode_counter` reached 0 and the game did not crash. Ending run 2 gracefully
starting random run iteration 3
You lost!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught
========================= 1 failed, 2 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1
","Traceback (most recent call last):
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py"", line 72, in execute
    await self.sdk.execute_as_task(PytestRunnerAgent, verbose=False)
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/volter-common/common/sdk/SDK.py"", line 254, in execute_as_task
    response = await agent.execute()
               ^^^^^^^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/game/pytest_runner_agent/logic.py"", line 30, in execute
    output = run_pytest(test_file_path, project_root=self.sdk.project_directory, verbose=self.verbose)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-std-agents/agent_lib/random_run_utils.py"", line 141, in run_pytest
    raise AssertionError(f""Pytest failed with exit code {exit_code}. Output:\n{output}"")
AssertionError: Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py .                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30  # More moves needed for battle
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            try:
>               scene.run()

main_game/tests/test_main_game_scene.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
main_game/scenes/main_game_scene.py:37: in run
    self.check_battle_end()
main_game/scenes/main_game_scene.py:141: in check_battle_end
    self._quit_whole_game()
../../../../mge2/mini_game_engine/engine/lib.py:459: in _quit_whole_game
    self._app.quit_whole_game()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>

    def quit_whole_game(self):
        self.terminated = True
>       raise AbstractApp._QuitWholeGame()
E       mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught

../../../../mge2/mini_game_engine/engine/lib.py:625: _QuitWholeGame
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
`random_mode_counter` reached 0 and the game did not crash. Ending run 0 gracefully
starting random run iteration 1
`random_mode_counter` reached 0 and the game did not crash. Ending run 1 gracefully
starting random run iteration 2
`random_mode_counter` reached 0 and the game did not crash. Ending run 2 gracefully
starting random run iteration 3
You lost!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught
========================= 1 failed, 2 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_bench/bench_utils.py"", line 93, in execute_agent
    asyncio.run(agent.execute())
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/runners.py"", line 190, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/runners.py"", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File ""/opt/hostedtoolcache/Python/3.11.9/x64/lib/python3.11/asyncio/base_events.py"", line 654, in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
  File ""/home/runner/_work/volter-monorepo/volter-monorepo/volter-monorepo/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py"", line 79, in execute
    raise FixableException(
common.exceptions.FixableException: After 5 attempts to debug, could not create a bug-free game. Still have error Pytest failed with exit code 1. Output:
============================= test session starts ==============================
platform linux -- Python 3.11.9, pytest-7.3.1, pluggy-1.5.0
rootdir: [REDACT]/volter-monorepo/packages/lib-volter-mge2
configfile: pytest.ini
plugins: cov-4.1.0, time-machine-2.16.0, sugar-0.9.7, timeout-2.3.1, html-3.2.0, metadata-3.1.1, Faker-30.10.0, anyio-4.6.2.post1, asyncio-0.23.8
asyncio: mode=Mode.STRICT
collected 3 items

main_game/tests/test_main_game_scene.py F                                [ 33%]
main_game/tests/test_main_menu_scene.py .                                [ 66%]
main_game/tests/test_whole_game.py .                                     [100%]

=================================== FAILURES ===================================
__________ TestMainGameSceneRandomRun.test_main_game_scene_random_run __________

self = <tests.test_main_game_scene.TestMainGameSceneRandomRun object at 0x[REDACTED]>
app = <main_game.main.App object at 0x[REDACTED]>

    def test_main_game_scene_random_run(self, app):
        for i in range(10):
            print(f""starting random run iteration {i}"")
            HumanListener.random_mode = True
            HumanListener.random_mode_counter = 30  # More moves needed for battle
    
            player = app.create_player(f""player_{i}"")
            scene = MainGameScene(app, player)
    
            try:
>               scene.run()

main_game/tests/test_main_game_scene.py:23: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
main_game/scenes/main_game_scene.py:37: in run
    self.check_battle_end()
main_game/scenes/main_game_scene.py:141: in check_battle_end
    self._quit_whole_game()
../../../../mge2/mini_game_engine/engine/lib.py:459: in _quit_whole_game
    self._app.quit_whole_game()
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <main_game.main.App object at 0x[REDACTED]>

    def quit_whole_game(self):
        self.terminated = True
>       raise AbstractApp._QuitWholeGame()
E       mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught

../../../../mge2/mini_game_engine/engine/lib.py:625: _QuitWholeGame
----------------------------- Captured stdout call -----------------------------
starting random run iteration 0
`random_mode_counter` reached 0 and the game did not crash. Ending run 0 gracefully
starting random run iteration 1
`random_mode_counter` reached 0 and the game did not crash. Ending run 1 gracefully
starting random run iteration 2
`random_mode_counter` reached 0 and the game did not crash. Ending run 2 gracefully
starting random run iteration 3
You lost!
=========================== short test summary info ============================
FAILED main_game/tests/test_main_game_scene.py::TestMainGameSceneRandomRun::test_main_game_scene_random_run - mini_game_engine.engine.lib.AbstractApp._QuitWholeGame: Game terminated gracefully. If you intended to quit the game, this exception is expected and should be caught
========================= 1 failed, 2 passed in [REDACTED]s ==========================
PYTEST_EXIT_CODE: 1

",['new_prompt_logs/999999_130884_OneShotCoreAgent'],ladder/creature_battler_05_7/main_game,https://github.com/volter-ai/volter-monorepo/blob/30b0a30ad2e08ea85b3c80ae07d2e22248988467/packages/lib-volter-mge2/mge_agents/internal/one_shot_gen/one_shot_core.py,main,mge2_game,,gpt-4o,gpt-4o,gpt-4o-mini,claude-3-5-sonnet-20241022
