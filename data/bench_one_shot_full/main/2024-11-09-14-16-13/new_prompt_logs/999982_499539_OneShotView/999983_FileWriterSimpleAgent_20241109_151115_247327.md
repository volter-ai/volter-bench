Role: system
Content: You are a helpful assistant specialized in changing files based on proposed changes.
__________________
Role: user
Content: ## Proposed Code Change
Let me analyze the issue and propose a solution.

**Issue Description:**
Looking at the image and the error, there appear to be several problems:

1. The UI simulator is timing out after 120s, suggesting it can't properly interact with the buttons
2. Only one skill button (Tackle) is visible in the UI area, when there should be multiple skills displayed in a grid
3. The error suggests connection issues, but this appears to be secondary to the main UI interaction problem

The core issue seems to be with the skill buttons rendering and interaction logic. The current implementation may not be properly handling the skills array or the button click events.

**Proposed Solution:**

1. Fix the optional chaining in the skills mapping logic - the current implementation could cause rendering issues
2. Ensure proper null checking for the skills collection
3. Improve the skill button click handler to more reliably match skills with available button slugs
4. Add proper error states and loading indicators

Here's the implementation:

# Excerpt ID: 5b24dc64-fc11-4c1e-acb9-a5296c94c66e
```jsx main_game/templates/MainGameScene.tsx
import { useCurrentButtons } from "@/lib/useChoices.ts"
import { Shield, Swords } from 'lucide-react'
import { CreatureCard } from "@/components/ui/custom/creature/creature_card"
import { PlayerCard } from "@/components/ui/custom/player/player_card"
import { SkillButton } from "@/components/ui/custom/skill/skill_button"

interface Skill {
  __type: "Skill"
  uid: string
  display_name: string
  description: string
  stats: {
    base_damage: number
  }
}

interface Creature {
  __type: "Creature"
  uid: string
  display_name: string
  stats: {
    hp: number
    max_hp: number
  }
  collections: {
    skills: Skill[]
  }
}

interface Player {
  __type: "Player"
  uid: string
  display_name: string
  collections: {
    creatures: Creature[]
  }
}

interface GameUIData {
  entities: {
    player: Player
    bot: Player
    player_creature: Creature
    bot_creature: Creature
  }
}

export function MainGameSceneView(props: { data: GameUIData }) {
  const {
    availableButtonSlugs,
    emitButtonClick
  } = useCurrentButtons()

  const { player, bot, player_creature, bot_creature } = props.data?.entities || {}

  if (!player || !bot || !player_creature || !bot_creature) {
    return <div className="h-screen aspect-video bg-background flex items-center justify-center">
      Loading game data...
    </div>
  }

  const handleSkillClick = (skillUid: string) => {
    const matchingSlug = availableButtonSlugs.find(slug => 
      slug.toLowerCase().includes(skillUid.toLowerCase())
    )
    
    if (matchingSlug) {
      emitButtonClick(matchingSlug)
    }
  }

  const skills = player_creature.collections?.skills || []

  return (
    <div className="h-screen aspect-video bg-background flex flex-col">
      {/* HUD */}
      <div className="h-1/6 flex justify-between items-center px-4 border-b">
        <PlayerCard
          uid={player.uid}
          name={player.display_name}
          imageUrl=""
        />
        <div className="flex gap-4">
          <Shield className="w-6 h-6" />
          <Swords className="w-6 h-6" />
        </div>
        <PlayerCard
          uid={bot.uid}
          name={bot.display_name}
          imageUrl=""
        />
      </div>

      {/* Battlefield */}
      <div className="h-3/6 flex justify-between items-center px-16">
        <div className="flex flex-col items-center">
          <CreatureCard
            uid={player_creature.uid}
            name={player_creature.display_name}
            currentHp={player_creature.stats.hp}
            maxHp={player_creature.stats.max_hp}
            imageUrl=""
          />
          <div className="mt-2 text-sm font-bold">Your Creature</div>
        </div>

        <div className="flex flex-col items-center">
          <CreatureCard
            uid={bot_creature.uid}
            name={bot_creature.display_name}
            currentHp={bot_creature.stats.hp}
            maxHp={bot_creature.stats.max_hp}
            imageUrl=""
          />
          <div className="mt-2 text-sm font-bold">Opponent's Creature</div>
        </div>
      </div>

      {/* UI Area */}
      <div className="h-2/6 bg-muted p-4 rounded-t-lg">
        <div className="grid grid-cols-2 gap-4 h-full">
          {skills.length > 0 ? (
            skills.map((skill) => (
              <SkillButton
                key={skill.uid}
                uid={skill.uid}
                skillName={skill.display_name}
                description={skill.description}
                stats={{
                  damage: skill.stats.base_damage
                }}
                disabled={!availableButtonSlugs.some(slug => 
                  slug.toLowerCase().includes(skill.uid.toLowerCase())
                )}
                onClick={() => handleSkillClick(skill.uid)}
              />
            ))
          ) : (
            <div className="col-span-2 text-center text-muted-foreground">
              No skills available
            </div>
          )}
        </div>
      </div>
    </div>
  )
}
```

Key changes made:
1. Simplified the skills array access with a default empty array
2. Improved the skill button click handler to be more reliable in matching slugs
3. Cleaned up the skills rendering logic with proper conditional rendering
4. Made the slug matching case-insensitive for better reliability
5. Improved the layout structure for better visibility of all skills

These changes should resolve the timeout issues by ensuring the UI is properly interactive and the button clicks are properly handled.

## Directions
Reply with a list of actions in the following format. The response should only contain the JSON list of actions, no other text.
Make sure you are using the excerpt_id which contains the entire contents of the file.

Each action in the list must have these fields:
- action: Must be "overwrite"
- excerpt_id: The ID of the excerpt to use
- file_path: The relative path to the file

Example format for multiple files:
[
    {
        "action": "overwrite",
        "excerpt_id": "abc1",
        "file_path": "src/main.py"
    },
    {
        "action": "overwrite",
        "excerpt_id": "def2",
        "file_path": "tests/test_main.py"
    }
]
__________________
Role: assistant
Content: 
__________________
