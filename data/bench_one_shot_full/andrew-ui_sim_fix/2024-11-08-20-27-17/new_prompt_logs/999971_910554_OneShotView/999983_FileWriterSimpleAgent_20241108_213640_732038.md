Role: system
Content: You are a helpful assistant specialized in changing files based on proposed changes.
__________________
Role: user
Content: ## Proposed Code Change
Let me analyze the issue and provide a solution.

**Issue Description:**
Looking at the image and the error, there appears to be a timeout issue where the UI simulator is unable to interact with the buttons properly. The main problems I notice are:

1. The "Waiting for available actions..." message is showing, indicating no buttons are being rendered
2. The error suggests that button clicks aren't being registered properly
3. The timeout error indicates the game isn't progressing as expected

The core issue seems to be that the button system isn't properly handling the available button slugs and the skill filtering logic may be incorrect.

**Proposed Solution:**
1. Modify the skill filtering logic to ensure we're properly matching available button slugs with skills
2. Add error boundaries around the button rendering logic
3. Ensure the button click handler is properly emitting the correct slugs
4. Add proper null checks for the skills collection

Here's the implementation:

# Excerpt ID: 997db40b-f6e3-4002-9357-8ce0efc870d1
```jsx main_game/templates/MainGameScene.tsx
import { useCurrentButtons } from "@/lib/useChoices.ts";
import { Sword, Shield, Zap } from 'lucide-react'
import { CreatureCard } from "@/components/ui/custom/creature/creature_card"
import { SkillButton } from "@/components/ui/custom/skill/skill_button"
import { PlayerCard } from "@/components/ui/custom/player/player_card"

interface Skill {
  __type: "Skill"
  uid: string
  display_name: string
  description: string
  stats: {
    base_damage: number
  }
}

interface Creature {
  __type: "Creature"
  uid: string
  display_name: string
  description: string
  stats: {
    hp: number
    max_hp: number
    attack: number
    defense: number
    speed: number
  }
  collections: {
    skills: Skill[]
  }
}

interface Player {
  __type: "Player"
  uid: string
  display_name: string
  collections: {
    creatures: Creature[]
  }
}

interface GameUIData {
  entities: {
    player: Player
    opponent: Player
    player_creature: Creature
    opponent_creature: Creature
  }
}

export function MainGameSceneView(props: { data: GameUIData }) {
  const {
    availableButtonSlugs,
    emitButtonClick
  } = useCurrentButtons()

  const { player_creature, opponent_creature, player, opponent } = props.data.entities

  if (!player_creature || !opponent_creature || !player || !opponent) {
    return <div className="w-full h-full aspect-[16/9] bg-slate-800 flex items-center justify-center">
      <p className="text-white">Loading battle...</p>
    </div>
  }

  const availableSkills = player_creature.collections.skills?.filter(skill => 
    availableButtonSlugs.includes(skill.uid)
  ) || []

  return (
    <div className="w-full h-full aspect-[16/9] bg-slate-800 flex flex-col">
      {/* HUD */}
      <div className="w-full bg-slate-900 p-4 flex justify-between items-center">
        <PlayerCard
          uid={player.uid}
          name={player.display_name}
          imageUrl=""
        />
        <PlayerCard
          uid={opponent.uid}
          name={opponent.display_name}
          imageUrl=""
        />
      </div>

      {/* Battlefield */}
      <div className="flex-1 flex justify-between items-center px-16 bg-slate-700">
        <div className="flex flex-col items-center gap-2">
          <CreatureCard
            uid={player_creature.uid}
            name={player_creature.display_name}
            currentHp={player_creature.stats.hp}
            maxHp={player_creature.stats.max_hp}
            imageUrl=""
          />
          <div className="flex gap-2 text-white">
            <div className="flex items-center gap-1">
              <Sword className="w-4 h-4" />
              <span>{player_creature.stats.attack}</span>
            </div>
            <div className="flex items-center gap-1">
              <Shield className="w-4 h-4" />
              <span>{player_creature.stats.defense}</span>
            </div>
            <div className="flex items-center gap-1">
              <Zap className="w-4 h-4" />
              <span>{player_creature.stats.speed}</span>
            </div>
          </div>
        </div>

        <div className="flex flex-col items-center gap-2">
          <CreatureCard
            uid={opponent_creature.uid}
            name={opponent_creature.display_name}
            currentHp={opponent_creature.stats.hp}
            maxHp={opponent_creature.stats.max_hp}
            imageUrl=""
          />
          <div className="flex gap-2 text-white">
            <div className="flex items-center gap-1">
              <Sword className="w-4 h-4" />
              <span>{opponent_creature.stats.attack}</span>
            </div>
            <div className="flex items-center gap-1">
              <Shield className="w-4 h-4" />
              <span>{opponent_creature.stats.defense}</span>
            </div>
            <div className="flex items-center gap-1">
              <Zap className="w-4 h-4" />
              <span>{opponent_creature.stats.speed}</span>
            </div>
          </div>
        </div>
      </div>

      {/* Action UI */}
      <div className="bg-slate-900 p-4 min-h-[200px]">
        {availableButtonSlugs.length > 0 && availableSkills.length > 0 ? (
          <div className="grid grid-cols-2 gap-2">
            {availableSkills.map((skill) => (
              <SkillButton
                key={skill.uid}
                uid={skill.uid}
                name={skill.display_name}
                description={skill.description}
                damage={skill.stats.base_damage}
                onClick={() => emitButtonClick(skill.uid)}
              />
            ))}
          </div>
        ) : (
          <div className="flex items-center justify-center h-full">
            <p className="text-white">Waiting for available actions...</p>
          </div>
        )}
      </div>
    </div>
  )
}
```

Key changes made:
1. Separated the skill filtering logic into a separate constant for better error handling
2. Added a null check for the skills collection using optional chaining
3. Modified the button rendering condition to check both availableButtonSlugs and availableSkills
4. Simplified the skill filtering logic to be more direct

These changes should help resolve the timeout issues by ensuring the button system properly handles all cases and correctly emits button clicks.

## Directions
Reply with a list of actions in the following format. The response should only contain the JSON list of actions, no other text.
Make sure you are using the excerpt_id which contains the entire contents of the file.

Each action in the list must have these fields:
- action: Must be "overwrite"
- excerpt_id: The ID of the excerpt to use
- file_path: The relative path to the file

Example format for multiple files:
[
    {
        "action": "overwrite",
        "excerpt_id": "abc1",
        "file_path": "src/main.py"
    },
    {
        "action": "overwrite",
        "excerpt_id": "def2",
        "file_path": "tests/test_main.py"
    }
]
__________________
Role: assistant
Content: 
__________________
